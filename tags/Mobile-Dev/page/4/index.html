<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=en><![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang=en><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang=en><![endif]--><!--[if gt IE 8]><!--><html class=no-js lang=en><!--<![endif]--><head><meta charset=utf-8><title>Mobile Dev &#8211; Le murmure de Julian</title><meta name=description content><meta property="og:title" content="Mobile Dev"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://blog.jln.co/tags/Mobile-Dev/"><meta property="og:image" content="https://blog.jln.co/images/avatar.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.jln.co/images/avatar.png"><meta name=twitter:title content="Mobile Dev"><meta name=twitter:description content><link rel=canonical href=https://blog.jln.co/tags/Mobile-Dev/><link rel=alternate type=application/rss+xml href=https://blog.jln.co/tags/Mobile-Dev/feed.xml title="Le murmure de Julian"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/main.css><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel=stylesheet type=text/css><meta http-equiv=cleartype content="on"><meta name=generator content="Hugo 0.119.0"><script src=/js/vendor/modernizr-2.6.2.custom.min.js></script>
<script async src=https://unpkg.com/mermaid@8.2.3/dist/mermaid.min.js></script>
<link rel="shortcut icon" href=/favicon.png></head><body id=post-index><nav id=dl-menu class=dl-menuwrapper role=navigation style=display:inline-block><button class=dl-trigger>Open Menu</button><ul class=dl-menu><li><a href=/>Home</a></li><li><a href=#>About</a><ul class=dl-submenu><li><img src=/images/avatar.png alt="Julian Shen's photo" class=author-photo><h4>Julian Shen</h4><p>Softward developer</p></li><li><a href=mailto:julianshen22@gmail.com><i class="fa fa-fw fa-envelope"></i> Email</a></li><li><a href=https://linkedin.com/in/julianshen><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a></li><li><a href=https://github.com/julianshen><i class="fa fa-fw fa-github"></i> GitHub</a></li><li><a href=https://instagram.com/julianshen><i class="fa fa-fw fa-instagram"></i> Instagram</a></li></ul></li><li><a href=#>Posts</a><ul class=dl-submenu><li><a href=/post/>All Posts</a></li><li><a href=/tags/>All Tags</a></li></ul></li><li><a href=/></a></li></ul></nav><div class=entry-header><div class=header-title><div class=header-title-wrap><h1><a href=/ title="Go to the homepage">Le murmure de Julian</a></h1><h2>Mobile Dev</h2></div></div></div><div id=main role=main><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-10 14:19:21 +0000 UTC"><a href=/Generating-Facebook-key-hash-for-Android/>May 10, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>
Reading time ~1 minute</span></div><h1 class=entry-title><a href=/Generating-Facebook-key-hash-for-Android/ rel=bookmark title="Generating Facebook key hash for Android" itemprop=url>Generating Facebook key hash for Android</a></h1></header><div class=entry-content><div class=posterous_autopost><p>According to<a href=http://developers.facebook.com/docs/guides/mobile/#android> Facebook mobile development document</a> (Android), you need to generate a key hash for your application in order to apply Facebook SSO(Single Sign on).</p><p>Here is the formal way to do this:</p><blockquote><p><span style=color:#9c0>keytool -exportcert -alias androiddebugkey -keystore ~/.android/debug.keystore | openssl sha1 -binary | openssl base64</span></p></blockquote><p>But sometimes you won&rsquo;t have a tradtional key store especially when building with Android open sources. Keys in Android open sources are in pk8 format. In order to generate key hashes with these keys, you need to tranfer them into a pk12 key store.</p><p>I created another way to generate keyhash without <em><strong>keytool</strong></em> and <em><strong>openssl</strong></em>. Here is the source codes: <a href=https://github.com/julianshen/FacebookKeyHashGen>FacebookKeyHashGen</a></p><p>This program get package sigature directly from package itself. </p></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-09 00:34:09 +0000 UTC"><a href=/POC%E7%AD%86%E8%A8%98Rhino-on-Android-%E6%96%B0%E7%9A%84onClickListener/>May 9, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>
Reading time ~3 minutes</span></div><h1 class=entry-title><a href=/POC%E7%AD%86%E8%A8%98Rhino-on-Android-%E6%96%B0%E7%9A%84onClickListener/ rel=bookmark title="[POC][筆記][Rhino on Android] - 新的onClickListener" itemprop=url>[POC][筆記][Rhino on Android] - 新的onClickListener</a></h1></header><div class=entry-content><div class=posterous_autopost><p><a href=http://julianshen.posterous.com/pocrhino-developing-android-with-js-onclickli>上次的作法</a>:</p><blockquote><p><span style=color:maroon>var</span> button1 = findview(R.id(<span style=color:#36f>&lsquo;button1&rsquo;</span>));</p><p>button1.setOnClickListener(<span style=color:maroon>function</span>(view, methodName)<br>{<br>     if (methodName == <span style=color:#36f>&ldquo;onClick&rdquo;</span>) {<br>         log(&ldquo;MyScript&rdquo;, &ldquo;clicked&rdquo;);<br>} });</p></blockquote><p>當然不是很滿意, &ldquo;if(methodName == "onClick&rdquo;)&ldquo;這樣的寫法太醜了啦!</p><p>所以這次的目標是:</p><blockquote class=posterous_short_quote><p>button1.onclick = function(view) {</p><p>     log("MyScript&rdquo;, &ldquo;clicked&rdquo;);</p><p>     alert('Hi there!&rsquo;);</p><p>};</p></blockquote><p>這樣比較像印象中javascript的寫法</p><p>為了達到這目的, 必須在View中加入onclick這個property, 但原本View class(Java)並沒這東西, 如何將它包裝出來?</p><p>Rhino對於Javascript使用原生的java objects並不是直接使用, 還是有透過一層包裝, 因此這就是要做出這個property的路了, 包裝的點在於<a href=http://www.mozilla.org/rhino/apidocs/org/mozilla/javascript/WrapFactory.html>WrapFactory</a>, 而原生的Java object會被包裝長NativeJavaObject </p><p>而Rhino允許我們用自己的WrapFactory取代原本的, 像是這樣:</p><blockquote><p>jsContext.setWrapFactory(new <strong><span style=color:#f60>AndroidWrapFactory()</span></strong>);</p></blockquote><p>因此我們會需要自己實作這一個AndroidWrapFactory, 把原本的View改用不同的包裝, 而非原本的NativeJavaObject, 基本上只需要實作wrapAsJavaObject即可:</p><p><script src="https://gist.github.com/961470.js?file=AndroidWrapFactory.java"></script></p><p>這邊用了一個新實作的ViewWrapper來取代NativeJavaObject</p><p><script src="https://gist.github.com/961471.js?file=ViewWrapper.java"></script></p><p>本來我的打算是繼承自NativeJavaObject, 然後再加入自己的東西, 不過後來發現這樣的作法總會在"put"時出差錯, 原因是NativeJavaObject是沒辦法加入新的member了(其實這說法有點問題, 應該是只要設prototype給它的話還是可以), 加上一些比較實用的function是定義在ScriptableObject的裡面, 因此, 我最後採用ScriptableObject來包裝</p><p>但要如何在ScriptableObject裡面實現像NativeJavaObject那樣可以直接叫用原本的Java class裡面的member呢?這部份不用自己實作, 只要把原本的NativeJavaObject當做這新的ViewWrapper的prototype就好了, 所以這邊constructor呼叫的super contructor是:</p><blockquote class=posterous_short_quote><p>public ScriptableObject(Scriptable scope, Scriptable prototype)</p><p>===> super(scope, new NativeJavaObject(scope, javaObject, staticType));</p></blockquote><p>defineProperty這包裝是從ScritableObject那邊改寫其中一個過來的, 主要是用來讓我們可以把這些"onlick",&ldquo;onlongclick"包裝成property, 在ViewWrapper可以實作getter和setter, 為了避免名稱上的混淆, 所以把getter的prefix定義成"jsget"而setter是"jsset&rdquo;</p><p>在onlick的setter中, 除了將function object存起來外, 還直接對原本包裝的View設一個OnClickListener, 動作則是執行這個Function object</p><p>最後, 前面的範例裡面有一個"alert('Hi! there&rsquo;)&ldquo;, 因此為了"alert()"多實作一個Alert.java出來(跟上面的無關啦), 這是source:</p><p><script src="https://gist.github.com/961481.js?file=Alert.java"></script></p><p>接下來的目標, </p><ul><li>包裝一個實際真的可以拿來開發的package, release 0.1 alpha</li><li>實作XmlHttpRequest</li><li>Adapter & AdapterView, Service & Provider</li></ul></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-03 12:35:19 +0000 UTC"><a href=/POC%E7%AD%86%E8%A8%98Rhino-Developing-Android-with-JS-onClickListener/>May 3, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>
Reading time ~1 minute</span></div><h1 class=entry-title><a href=/POC%E7%AD%86%E8%A8%98Rhino-Developing-Android-with-JS-onClickListener/ rel=bookmark title="[POC][筆記][Rhino] Developing Android with JS - onClickListener" itemprop=url>[POC][筆記][Rhino] Developing Android with JS - onClickListener</a></h1></header><div class=entry-content><div class=posterous_autopost><p><a href=http://julianshen.posterous.com/poc-using-javascript-to-develop-android-activ>上次做的</a>僅止於setText這個簡單的動作, 那像是處理click這類的怎做?</p><p>先拿click來做範例, 在Android中, 如果要替一個view加上處理click動作要利用到View.setOnClickListener, 但setOnClickListener的參數是onClickListener, 這是一個java interface, 在Rhino中如何實作一個Java interface?</p><p>首先, 不要被Rhino的文件給騙了, 那有問題(還花了我一個晚上看 :( ), Rhino的source codes裡有個example目錄, 裡面有隻SwingApplication.js, 答案就在這邊</p><p>因此, onClick就會像是這樣:</p><blockquote><p><span style=color:maroon>var</span> button1 = findview(R.id(<span style=color:#36f>&lsquo;button1&rsquo;</span>));</p><p>button1.setOnClickListener(<span style=color:maroon>function</span>(view, methodName)<br>{<br>     if (methodName == <span style=color:#36f>&ldquo;onClick&rdquo;</span>) {<br>         log(&ldquo;MyScript&rdquo;, &ldquo;clicked&rdquo;);<br>} });</p></blockquote><p>在這function內, 必須要自己判斷methodName來知道是哪個method被呼叫到, 應該是所有的java interface都可以用這樣去實作</p><p>OK, 這樣&mldr;很醜&mldr;繼續改進</p></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-01 23:27:29 +0000 UTC"><a href=/POC-Using-javascript-to-develop-Android-Activity/>May 1, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>
Reading time ~3 minutes</span></div><h1 class=entry-title><a href=/POC-Using-javascript-to-develop-Android-Activity/ rel=bookmark title="[POC] Using javascript to develop Android Activity" itemprop=url>[POC] Using javascript to develop Android Activity</a></h1></header><div class=entry-content><div class=posterous_autopost><p>好久沒玩些好玩的了&mldr;.先來點小菜&mldr;.(POC = Prove of concept, 只是剛好有些想法, 所以來證明一下可不可行)</p><p>基本的想法是想用類似下面的javascript來寫出Android Activity(當然, 要延伸成其他的應該也沒問題)</p><p><a href="https://gist.github.com/950551.js?file=gistfile1">https://gist.github.com/950551.js?file=gistfile1</a></p><p>這一個script有幾個簡單的組成 : </p><ol><li>getcontentview : 用來指定這個activity所要用的main layout ID</li><li>oncreate : 在Activity oncreate時被呼叫</li><li>onresume : 在Activity onresume時被呼叫</li><li>onpause : 在Activity onpause時被呼叫</li><li>基本延伸函數 : <ul><li>log: 等同於Log.d</li><li>findview: 等同於findViewById</li><li>R.layout(&ldquo;layoutname&rdquo;): 等同於R.layout.layoutname (同樣的R.id(&ldquo;&rdquo;)也是&mldr;)</li></ul></li></ol><p>因為要在原本Android Java的平台上跑Javascript, 所以需要一個Javascript engine做為一個平台, 這邊選用的是<a href=http://www.mozilla.org/rhino/>Mozilla Rhino</a></p><p>Rhino可以幾乎無痛的在Android上使用, 當然<a href=http://code.google.com/p/android-scripting/>SL4A</a>有更多的script engine的選擇, 但SL4A的方向不同, 我是想弄一個也可以寫一般的Android program的script</p><p><strong>初始化Javascript engine</strong></p><p><script src="https://gist.github.com/950560.js?file=gistfile1.java"></script></p><p>第一個版本, 只是拿來實驗的, 所以script先放在asset裡面, 這一段會初始化基本的script engine, 然後從asset目錄裡面載入"init.js"</p><p>首先要先初始化一個Context instance, 所有的script執行都是要透過這個Context的, 不用後可以透過.exit()來釋放資源</p><blockquote class=posterous_short_quote><p>jsContext.setOptimizationLevel(-1);</p></blockquote><p>setOptimizationLevel(-1)這段很重要, 沒設成-1的話是無法在Android上跑的, 原因是Rhino會把javascript編譯成java bytecode以增加執行效率, 但這bytecode是標準的java bytecode而非Android dalvik的bytecode, 設成-1的話, Rhino會改用Intepreter來跑, 而非先compile</p><p><strong>Host objects 和 Host functions</strong></p><blockquote class=posterous_medium_quote><p>ScriptableObject.putProperty(jsScope, &ldquo;R&rdquo;, RObj);</p><p>ScriptableObject.putProperty(jsScope, &ldquo;log&rdquo;, new Log());</p><p>ScriptableObject.putProperty(jsScope, &ldquo;findview&rdquo;, new FindViewById(this));</p></blockquote><p>這一段包裝了一個host object和兩個host functions讓script使用(亦即是前述的5)</p><p>我把R包裝成另一個Object供javascript使用(因為我還沒找到如何讓Rhino使用static fields), 這包裝叫Rwrapper.java:</p><p><script src="https://gist.github.com/950572.js?file=gistfile1.java"></script></p><p>只是把R用reflection包裝一下而已</p><p>至於javascript function的部份, 其實也不難, 只要implement Function.call就可以了, 這邊實作了兩個(繼承自BaseFunction), Log.java和FindViewById.java</p><p>Log.java: <script src="https://gist.github.com/950575.js?file=gistfile1.java"></script></p><p>FindViewById.java: <script src="https://gist.github.com/950577.js?file=gistfile1.java"></script></p><p>不管是Object或是Function, 其實都是被當做objects來看待, 所以只要利用ScriptableObject.putProperty放到目前的scope去就可以給script取用了</p><p>目前看來, 這想法可行, 而且還蠻容易的, 缺乏的只是一些包裝而已, 甚至直接對view做操作也是可行的, 有空(會有空嗎?) 再來玩深入點.. :P</p></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-01 21:26:35 +0000 UTC"><a href=/Recognize-your-friend-with-Face.com/>May 1, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>
Reading time ~3 minutes</span></div><h1 class=entry-title><a href=/Recognize-your-friend-with-Face.com/ rel=bookmark title="Recognize your friend with Face.com" itemprop=url>Recognize your friend with Face.com</a></h1></header><div class=entry-content><div class=posterous_autopost><p>替照片上的每個人都加上標籤(tag)是一個蠻好用的功能, 這可以方便你找到有某人的照片, 或是一群人在某時的合照, 如果善加利用是相當好用的功能, 目前主流的幾個相片服務像是Flickr, Facebook, Picasa等等, 都有這樣的功能</p><p>其中以Picasa的功能最為先進, 它可以自動幫你把你所有照片裡的朋友都挑出來標示, 不像Flickr跟Facebook就只能手動</p><p>如果每張照片都只能手動標示的話, 標示完所有的照片是很累人的, 更何況可能還有很多未標示的舊照片, 就這點來說, Picasa就強勁很多, 至於Facebook和Flickr呢? 所幸有<a href=http://face.com/>Face.com</a></p><p>Face.com是一個做自動標示的服務, 其實這樣講有點狹隘, 自動標示照片的服務只是它其中一個產品 - <a href="http://apps.facebook.com/photo_tagger/?face_ref=pt_facedotcom_app_arrow&amp;utm_campaign=viral&amp;utm_source=face&amp;utm_medium=website">PhotoTagger</a>, PhotoTagger的用處就有點像Picasa做的一樣, 自動幫你把照片的人物找出來做標示:</p><div class="p_embed p_image_embed"><a href=http://posterous.com/getfile/files.posterous.com/temp-2011-05-01/yceenqFJnquzwdCACHGrskpJvwikahIeHDDgouzDJbozfcxmBvhtJjHyvDdi/_2011-05-01_8.59.35.png.scaled1000.png><img alt=_2011-05-01_8 height=585 src=http://posterous.com/getfile/files.posterous.com/temp-2011-05-01/yceenqFJnquzwdCACHGrskpJvwikahIeHDDgouzDJbozfcxmBvhtJjHyvDdi/_2011-05-01_8.59.35.png.scaled500.png width=500></a></div>當然準確度不會到100%那麼高啦, 不過加上手動輔助的話, 已經可以節省不少功夫了<p>此外還有PhotoFinder和CelebrityFindr&mldr;.不過這些並不是重點, 它真正比較強大的是, 它乾脆把它的Face detection和Face recogintion 的API開放出來, 讓你可以利用它們的雲端運算做出自己的應用</p><p>它的API是以REST的形態提供的, 支援的後端服務有Facebook, Flickr, Twitter, 基本的API也大致相當完整, train, detect, recongnize, tag等等, 如果是做Facebook相關的應用, 甚至可以省略過train的部份, 就可以達到辨識的效果</p><p>當然, 剛剛的應用像是PhotoTagger都是以拍完後的照片為目標而做的, 如果拍照完後馬上就可以找出有哪些人可以tag的話, 那就更棒了</p><p>為了實驗這個我寫了一個簡單的Android app - <a href=http://dl.dropbox.com/u/2789919/Face.me.apk>Face.me</a> , 只要拿著Android手機對著你朋友拍一張(按螢幕畫面), 它就會利用Face.com去找出你這朋友的名字 (可以從連結下載APK安裝, 因為Camera部分不熟, 寫的不太好, 可能會有bug, 就不open source了 :P) </p><p>這App利用了一個open source的Face.com的Java lib叫<a href=https://github.com/mhendred/face4j>face4j</a>, 基本上這lib移植到Android上並不困難, 它用到一些apache commons, http的library, 只要把這些含入就可以</p><p>要開發這個, 首先你必須要有Facebook API key和Face.com的API key, Face.com的API key可以到<a href=http://developers.face.com/new-application/>這裡</a>註冊個新的, 另外還得把Facebook的API key和secret註冊到Face.com上(看你信不信任它囉)</p><p>Facebook API的部份, 我是用<a href=https://github.com/facebook/facebook-android-sdk>Facebook Android SDK</a>去開發的, 其實也沒用到幾個API, 大致上只有login和取得自己的UID而已</p><p>另外由於face4j在reconigize這個method只支援檔案跟url兩種方式, 我另外修改了一個支援input stream的:</p><p><a href="https://gist.github.com/950492.js?file=gistfile1">https://gist.github.com/950492.js?file=gistfile1</a></p><p>剩下的部份就簡單了, 在Camera.takePicture的第三個參數的PictureCallback.onPictureTaken裡加上:</p><p><script src="https://gist.github.com/950494.js?file=gistfile1.java"></script></p></div></div></article><div class=pagination><ul class=inline-list><li><a href=/tags/Mobile-Dev/page/3/ class=btn>Previous</a></li><li><a href=/tags/Mobile-Dev/>1</a></li><li><a href=/tags/Mobile-Dev/page/2/>2</a></li><li><a href=/tags/Mobile-Dev/page/3/>3</a></li><li><strong class=current-page>4</strong></li><li><a href=/tags/Mobile-Dev/page/5/>5</a></li><li><a href=/tags/Mobile-Dev/page/6/>6</a></li><li><a href=/tags/Mobile-Dev/page/7/>7</a></li><li><a href=/tags/Mobile-Dev/page/8/>8</a></li><li><a href=/tags/Mobile-Dev/page/5/ class=btn>Next</a></li></ul></div></div><div class=footer-wrapper><footer role=contentinfo><span>Powered by <a href=https://gohugo.io/ rel=nofollow>Hugo</a> using the <a href=https://github.com/dldx/hpstr-hugo-theme rel=nofollow>HPSTR theme</a>.</span></footer></div><script src=//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js></script>
<script src=https://kit.fontawesome.com/872a53b461.js crossorigin=anonymous></script>
<script>window.jQuery||document.write('<script src="/js/vendor/jquery-1.9.1.min.js"><\/script>')</script><script src=/js/scripts.min.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-79243751-1","auto"),ga("send","pageview"))</script><div id=fb-root></div><script async defer crossorigin=anonymous src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=293999444006555&autoLogAppEvents=1" nonce=geZSUIUh></script></body></html>