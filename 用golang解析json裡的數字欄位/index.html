<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=en><![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang=en><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang=en><![endif]--><!--[if gt IE 8]><!--><html class=no-js lang=en><!--<![endif]--><head><meta charset=utf-8><title>用golang解析json裡的數字欄位 &#8211; Le murmure de Julian</title><meta name=description content><meta property="og:title" content="用golang解析json裡的數字欄位"><meta property="og:description" content="在寫網路相關應用的時候, 應該常常會碰到需要去解析JSON格式的資料, 而Go在這邊也已經內建了一個蠻方便的套件 - &ldquo;encoding/json&rdquo; 可以讓我們輕易地來處理這類型"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.jln.co/%E7%94%A8golang%E8%A7%A3%E6%9E%90json%E8%A3%A1%E7%9A%84%E6%95%B8%E5%AD%97%E6%AC%84%E4%BD%8D/"><meta property="og:image" content="https://blog.jln.co/images/posts/%E7%94%A8golang%E8%A7%A3%E6%9E%90json%E8%A3%A1%E7%9A%84%E6%95%B8%E5%AD%97%E6%AC%84%E4%BD%8D.md.jpg"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-07-05T14:54:23+08:00"><meta property="article:modified_time" content="2020-07-05T14:54:23+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.jln.co/images/posts/%E7%94%A8golang%E8%A7%A3%E6%9E%90json%E8%A3%A1%E7%9A%84%E6%95%B8%E5%AD%97%E6%AC%84%E4%BD%8D.md.jpg"><meta name=twitter:title content="用golang解析json裡的數字欄位"><meta name=twitter:description content="在寫網路相關應用的時候, 應該常常會碰到需要去解析JSON格式的資料, 而Go在這邊也已經內建了一個蠻方便的套件 - &ldquo;encoding/json&rdquo; 可以讓我們輕易地來處理這類型"><link rel=canonical href=https://blog.jln.co/%E7%94%A8golang%E8%A7%A3%E6%9E%90json%E8%A3%A1%E7%9A%84%E6%95%B8%E5%AD%97%E6%AC%84%E4%BD%8D/><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/main.css><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel=stylesheet type=text/css><meta http-equiv=cleartype content="on"><meta name=generator content="Hugo 0.119.0"><script src=/js/vendor/modernizr-2.6.2.custom.min.js></script>
<script async src=https://unpkg.com/mermaid@8.2.3/dist/mermaid.min.js></script>
<link rel="shortcut icon" href=/favicon.png></head><body id=post><nav id=dl-menu class=dl-menuwrapper role=navigation style=display:inline-block><button class=dl-trigger>Open Menu</button><ul class=dl-menu><li><a href=/>Home</a></li><li><a href=#>About</a><ul class=dl-submenu><li><img src=/images/avatar.png alt="Julian Shen's photo" class=author-photo><h4>Julian Shen</h4><p>Softward developer</p></li><li><a href=mailto:julianshen22@gmail.com><i class="fa fa-fw fa-envelope"></i> Email</a></li><li><a href=https://linkedin.com/in/julianshen><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a></li><li><a href=https://github.com/julianshen><i class="fa fa-fw fa-github"></i> GitHub</a></li><li><a href=https://instagram.com/julianshen><i class="fa fa-fw fa-instagram"></i> Instagram</a></li></ul></li><li><a href=#>Posts</a><ul class=dl-submenu><li><a href=/post/>All Posts</a></li><li><a href=/tags/>All Tags</a></li></ul></li><li><a href=/></a></li></ul></nav><div id=main role=main><article class=hentry><header class=header-title><div class=header-title-wrap><h1 class=entry-title><a href=/%E7%94%A8golang%E8%A7%A3%E6%9E%90json%E8%A3%A1%E7%9A%84%E6%95%B8%E5%AD%97%E6%AC%84%E4%BD%8D/ rel=bookmark title=用golang解析json裡的數字欄位>用golang解析json裡的數字欄位</a></h1><h2><span class="entry-date date published"><time datetime="2020-07-05 14:54:23 +0800 +0800">July 5, 2020</time></span></h2><p class=entry-reading-time><i class="fa fa-clock-o"></i>
Reading time ~4 minutes</p></div></header><div class=entry-content><p>在寫網路相關應用的時候, 應該常常會碰到需要去解析JSON格式的資料, 而Go在這邊也已經內建了一個蠻方便的套件 - <strong>&ldquo;encoding/json&rdquo;</strong> 可以讓我們輕易地來處理這類型的資料</p><p>先來看看下面這段範例:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Sample</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>Age</span> <span style=color:#66d9ef>int</span> 
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sampleData</span> = <span style=color:#e6db74>`{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;name&#34;:&#34;julian&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;age&#34;: -1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sample</span> <span style=color:#a6e22e>Sample</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>([]byte(<span style=color:#a6e22e>sampleData</span>), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>sample</span>)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	   panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>sample</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>[<a href=https://play.golang.org/p/YfOPBMXGGl5>執行</a>]</p><p>從這個範例可以看到, 我們可以用很簡單的程式碼, 把下面這段JSON內容給對應到<code>Sample</code>這個結構裡面</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;julian&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;age&#34;</span>: <span style=color:#ae81ff>-1</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>但這邊其實有一個問題, 如果你把這個JSON資料, 改成下面這樣子:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;julian&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;age&#34;</span>: <span style=color:#e6db74>&#34;-1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>這在現實世界應該蠻常看到的, 只是多加個雙引號而已, 大家應該也會預期這邊應該也會沒問題的解析出一樣的結果吧? 但你如果實際改了資料<a href=https://play.golang.org/p/nxMnQFY3CQ->執行看看</a>, 你得到的結果應該會是:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>panic: json: cannot unmarshal string into Go struct field Sample.Age of type int
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>goroutine <span style=color:#ae81ff>1</span> <span style=color:#f92672>[</span>running<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>main.main<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>	/tmp/sandbox247755092/prog.go:23 +0x162
</span></span></code></pre></div><p>這其實是 <em><strong>&ldquo;encoding/json&rdquo;</strong></em> 把雙引號的內容都當作字串來看, 所以當我要把它塞到一個 <em>int</em> 欄位時, 就會出事了</p><p>解決方法有好幾種, 下面就一一來看看:</p><h2 id=用field-tag來解決>用Field tag來解決</h2><p>如果把<code>Sample</code>的定義改成下面這樣:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Sample</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>Age</span> <span style=color:#66d9ef>int</span> <span style=color:#e6db74>`json:&#34;,string&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>[<a href=https://play.golang.org/p/qexEcHzamM3>執行範例</a>]</p><p>喔耶, 沒問題了耶!!!可以正常的解出資料了耶!! 慢著, 先別高興太早!! 再試試把雙引號拿掉看看(參考這個<a href=https://play.golang.org/p/Cz17VTbCBBX>範例</a>)</p><p>呃, 是怎樣啦!! 換成這個錯誤了!!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>panic: json: invalid use of ,string struct tag, trying to unmarshal unquoted value into int
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>goroutine <span style=color:#ae81ff>1</span> <span style=color:#f92672>[</span>running<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>main.main<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>	/tmp/sandbox912379425/prog.go:23 +0x162
</span></span></code></pre></div><p>在現實案例中, 的確是有可能碰到有時送來的資料有雙引號, 有時候沒有, 這方法是沒法一次滿足的</p><h2 id=利用unmarshaler界面來解決>利用Unmarshaler界面來解決</h2><p><em><strong>&ldquo;encoding/json&rdquo;</strong></em> 是可以讓開發者自行指定怎去解析JSON內容的, 只需要定義一個自定義的型別並實做Unmarshaler界面就可以了, 為了解決這個問題, 我們可以定義一個新的<code>MyInt</code>的型別, 並幫它實做<code>UnmarshalJSON</code>的方法, 參考下面範例:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MyInt</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>m</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MyInt</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>str</span> <span style=color:#f92672>:=</span> string(<span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>unquoted</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>Unquote</span>(<span style=color:#a6e22e>str</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	   <span style=color:#a6e22e>str</span> = <span style=color:#a6e22e>unquoted</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>Atoi</span>(<span style=color:#a6e22e>str</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#f92672>*</span><span style=color:#a6e22e>m</span> = <span style=color:#a6e22e>MyInt</span>(<span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Sample</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Age</span>  <span style=color:#a6e22e>MyInt</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>[<a href=https://play.golang.org/p/FAqSuBcDXgl>執行範例</a>]</p><p>在Sample這個結構中的Age欄位, 從原本的int改成MyInt, 這樣<code>json.Unmarshal</code>碰到Age這欄位的話, 就會用<code>MyInt</code>的<code>UnmarshalJSON</code>方法去解析</p><p>這方法是麻煩了點, 而且可能針對不同型別要去個別做, 但卻是可以同時處理掉前述兩種型態的資料, 程式沒那好看就是了</p><h2 id=使用jsonnumberhttpsgolangorgpkgencodingjsonnumber>使用<a href=https://golang.org/pkg/encoding/json/#Number>json.Number</a></h2><p>在 <em><strong>&ldquo;encoding/json&rdquo;</strong></em> 裡其實還提供一個資料型態<a href=https://golang.org/pkg/encoding/json/#Number>json.Number</a>, 這個應該是這個問題的比較正規的解法了, 把Sample的定義改成下面這樣:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Sample</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Age</span>  <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Number</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>[<a href=https://play.golang.org/p/sWbmNX1aZwi>執行範例</a>]</p><p>這方法也是可以無誤的解析兩種的型態, 然後當你要取用<code>Age</code>這欄位的<code>int</code>型態時, 你可以用<code>sample.Age.Int64()</code>去取得, 要多一層是麻煩點</p><p>那它是怎做到的呢? 來看一下它的原始碼:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#75715e>// A Number represents a JSON number literal.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Number</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// String returns the literal text of the number.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>n</span> <span style=color:#a6e22e>Number</span>) <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span> { <span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>n</span>) }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Float64 returns the number as a float64.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>n</span> <span style=color:#a6e22e>Number</span>) <span style=color:#a6e22e>Float64</span>() (<span style=color:#66d9ef>float64</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(string(<span style=color:#a6e22e>n</span>), <span style=color:#ae81ff>64</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Int64 returns the number as an int64.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>n</span> <span style=color:#a6e22e>Number</span>) <span style=color:#a6e22e>Int64</span>() (<span style=color:#66d9ef>int64</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseInt</span>(string(<span style=color:#a6e22e>n</span>), <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>64</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>會發現, 其實沒啥了不起的, Number本身就是一個string, 所以它是當字串在處理, 而當你需要數字表示(int或float)時, 再呼叫ParseInt或ParseFloat來處理</p><h2 id=使用-jsoniterhttpsgithubcomjson-iteratorgo-來取代-encodingjson>使用 <a href=https://github.com/json-iterator/go>Jsoniter</a> 來取代 &ldquo;encoding/json&rdquo;</h2><p><a href=https://github.com/json-iterator/go>Jsoniter</a>是一個號稱比原生的***&ldquo;encoding/json&rdquo;***效能還要來的更好的JSON處理套件, 除了Go的版本外, 它也有Java的版本</p><p>效能不在這邊的討論範圍, 但除效能外, 它也是最簡單解決這問題的方法, 先來看看完整的程式碼吧:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jsoniter</span> <span style=color:#e6db74>&#34;github.com/json-iterator/go&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>extra</span> <span style=color:#e6db74>&#34;github.com/json-iterator/go/extra&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Sample</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Age</span>  <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sampleData</span> = <span style=color:#e6db74>`{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;name&#34;:&#34;julian&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;age&#34;: 45
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sampleData2</span> = <span style=color:#e6db74>`{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;name&#34;:&#34;julian&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   &#34;age&#34;: &#34;45&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>extra</span>.<span style=color:#a6e22e>RegisterFuzzyDecoders</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sample</span> <span style=color:#a6e22e>Sample</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>jsoniter</span>.<span style=color:#a6e22e>Unmarshal</span>([]byte(<span style=color:#a6e22e>sampleData</span>), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>sample</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>sample</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>jsoniter</span>.<span style=color:#a6e22e>Unmarshal</span>([]byte(<span style=color:#a6e22e>sampleData2</span>), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>sample</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>sample</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>[<a href=https://play.golang.org/p/vKl1YcH6lt8>執行範例</a>]</p><p>為啥說是最簡單的方法呢? 首先, 它有跟 <em><strong>&ldquo;encoding/json&rdquo;</strong></em> 完全一樣的使用方法, 把套件換掉後, 程式幾乎一樣, 所以也不需要改啥程式, 但如果只有改這樣, 會發現問題都還是在, 並沒有解決掉, 這時候就要帶入它額外的功能 <code>FuzzyDecoders</code> 了, <code>FuzzyDecoders</code>是在它額外的套件裡面, 所以只需要加入import就可以用了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#a6e22e>extra</span> <span style=color:#e6db74>&#34;github.com/json-iterator/go/extra&#34;</span>
</span></span></code></pre></div><p>然後在開始使用前, 註冊 <code>FuzzyDecoders</code> 即可(<code>extra.RegisterFuzzyDecoders()</code>), 這樣, 不管有沒雙引號都不會有問題了!!</p><footer class=entry-meta><span class=entry-tags></span><div class=social-share><ul class="socialcount socialcount-small inline-list"><li class=facebook><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.jln.co%2f%25E7%2594%25A8golang%25E8%25A7%25A3%25E6%259E%2590json%25E8%25A3%25A1%25E7%259A%2584%25E6%2595%25B8%25E5%25AD%2597%25E6%25AC%2584%25E4%25BD%258D%2f" target=_blank title="Share on Facebook"><span class=count><i class="fa fa-facebook-square"></i> Like</span></a></li><li class=twitter><a href="https://twitter.com/intent/tweet?text=https%3a%2f%2fblog.jln.co%2f%25E7%2594%25A8golang%25E8%25A7%25A3%25E6%259E%2590json%25E8%25A3%25A1%25E7%259A%2584%25E6%2595%25B8%25E5%25AD%2597%25E6%25AC%2584%25E4%25BD%258D%2f" target=_blank title="Share on Twitter"><span class=count><i class="fa fa-twitter-square"></i> Tweet</span></a></li><li class=line><a href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fblog.jln.co%2f%25E7%2594%25A8golang%25E8%25A7%25A3%25E6%259E%2590json%25E8%25A3%25A1%25E7%259A%2584%25E6%2595%25B8%25E5%25AD%2597%25E6%25AC%2584%25E4%25BD%258D%2f" target=_blank title="Share on LINE"><span class=count><i class="fab fa-line"></i>LINE</span></a></li></ul></div></footer></div><section id=disqus_thread><div class=fb-comments data-href=https://blog.jln.co/%E7%94%A8golang%E8%A7%A3%E6%9E%90json%E8%A3%A1%E7%9A%84%E6%95%B8%E5%AD%97%E6%AC%84%E4%BD%8D/ data-numposts=5 data-width></div></section></article></div><div class=footer-wrapper><footer role=contentinfo><span>Powered by <a href=https://gohugo.io/ rel=nofollow>Hugo</a> using the <a href=https://github.com/dldx/hpstr-hugo-theme rel=nofollow>HPSTR theme</a>.</span></footer></div><script src=//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js></script>
<script src=https://kit.fontawesome.com/872a53b461.js crossorigin=anonymous></script>
<script>window.jQuery||document.write('<script src="/js/vendor/jquery-1.9.1.min.js"><\/script>')</script><script src=/js/scripts.min.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-79243751-1","auto"),ga("send","pageview"))</script><div id=fb-root></div><script async defer crossorigin=anonymous src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=293999444006555&autoLogAppEvents=1" nonce=geZSUIUh></script></body></html>