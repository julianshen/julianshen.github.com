<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>[node.js] 在heroku上用bower管理前端第三方元件 &#8211; Le murmure de Julian</title>
<meta name="description" content="朱隸安貓囈語錄">
<meta name="keywords" content="IFTTT, Blogger, nodejs">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://bit.ly/Nh8z1A">
<meta name="twitter:title" content="[node.js] 在heroku上用bower管理前端第三方元件">
<meta name="twitter:description" content="朱隸安貓囈語錄">
<meta name="twitter:creator" content="@jlnshen">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="[node.js] 在heroku上用bower管理前端第三方元件">
<meta property="og:description" content="朱隸安貓囈語錄">
<meta property="og:url" content="http://blog.jln.co/nodejs-%E5%9C%A8heroku%E4%B8%8A%E7%94%A8bower%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E7%AC%AC%E4%B8%89%E6%96%B9%E5%85%83%E4%BB%B6/">
<meta property="og:site_name" content="Le murmure de Julian">
<meta name="og:image" content="http://bit.ly/Nh8z1A">




<link rel="canonical" href="http://blog.jln.co/nodejs-%E5%9C%A8heroku%E4%B8%8A%E7%94%A8bower%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E7%AC%AC%E4%B8%89%E6%96%B9%E5%85%83%E4%BB%B6/">
<link href="http://blog.jln.co/feed.xml" type="application/atom+xml" rel="alternate" title="Le murmure de Julian Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://blog.jln.co/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://blog.jln.co/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://blog.jln.co/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://blog.jln.co/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://blog.jln.co/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://blog.jln.co/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://blog.jln.co/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://blog.jln.co/images/apple-touch-icon-144x144-precomposed.png">



  
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1789797875470932",
        enable_page_level_ads: true
    });
    </script>
  

</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://blog.jln.co/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://blog.jln.co/images/avatar.png" alt="Julian Shen photo" class="author-photo">
					<h4>Julian Shen</h4>
					<p>software deverloper</p>
				</li>
				<li>
					<a href="mailto:julianshen22@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/jlnshen"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/julianshen"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				
				<li>
					<a href="https://linkedin.com/in/julianshen"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/julianshen"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				<li>
					<a href="https://instagram.com/julianshen"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
				</li>
				<li>
					<a href="https://www.flickr.com/photos/julianshen"><i class="fa fa-fw fa-flickr"></i> Flickr</a>
				</li>
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://blog.jln.co/posts/">All Posts</a></li>
				<li><a href="http://blog.jln.co/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://blog.jln.co/nodejs-%E5%9C%A8heroku%E4%B8%8A%E7%94%A8bower%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E7%AC%AC%E4%B8%89%E6%96%B9%E5%85%83%E4%BB%B6/" rel="bookmark" title="[node.js] 在heroku上用bower管理前端第三方元件">[node.js] 在heroku上用bower管理前端第三方元件</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2012-11-07T23:19:07+08:00">November 07, 2012</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~1 minute
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>在做web applications時，或多或少都會使用到像是jQuery, bootstrap這類的第三方元件，使用已經host在既有CDN 的版本（比如說google的）是一個不錯的方法，但不是每一種都有這類方案，一個個從各網站下載回本地端又不是那麼容易管理，<a href="http://bit.ly/QuXxeM">bower</a>就是為此出現的，<a href="http://bit.ly/QuXxeM">bower</a>是一個類似npm的軟體，由Twitter所開發出來且是開放原始碼，所不同的是，npm是管理node.js相關的套件，但bower是管前端的<br/><br/>舉一個例子，你可以利用bower來安裝jQuery :<br/></p><blockquote><em>bower install jQuery</em></blockquote>bower會把jQuery 安裝到<i>&ldquo;components/jQuery&rdquo;</i> 目錄裡<br/><br/>在npm , 你可以把所有相關的模組設定在package.json中，這樣就不用一個個下&quot;npm install mypackage&quot;這樣的指令了，bower也有類似的設計，只是為了避免跟package.json造成混淆它採用的檔名是component.json，內容跟package.json差不多：<br/><blockquote><em>{</em><br/><em>    dependencies: {</em><br/><em>      &ldquo;JQuery&rdquo;: &ldquo;*&rdquo;</em><br/><em>    }</em><br/><em>}</em></blockquote>在Heroku deploy node.js app有個很方便的地方是，當你做git push 後，它會根據package.json自動幫你安裝相關的node.js 模組，但不幸的是它並不支援bower，只支援npm<br/><br/>還好Heroku很有彈性，可以藉由buildpack來自己加這部份<br/><br/><a href="http://bit.ly/SqrY1M">buildpack API</a>其實還蠻簡單的, 基本上只要準備三支shell script:<br/><ul><li>bin/detect</li><li>bin/compile</li><li>bin/release</li></ul><div>大部分的東西, 大多在&quot;bin/compile&quot;裡完成的</div><div><br/></div><div>自己做的buildpack也只要放github, 然後將自己app的buildpack指定到這來即可 (使用heroku toolbelt):</div><div><ul><li>新建的程式使用自己的buildpack:  <br/><i style="background-color: #cccccc;">heroku create myapp &ndash;buildpack <a href="http://bit.ly/SqrV6k">http://bit.ly/SqrV6k</a> </i></li><li>既有的程式更換buildpack:<br/><span style="background-color: #cccccc;"><i>heroku config:add BUILDPACK_URL=http://bit.ly/SqrV6k</i></span></li></ul></div>當然, 不需要重頭建立自己的buildpack, Heroku官方的buildpack都有open source在github上, 如<a href="http://bit.ly/RVJcUf">Node.js buildpack</a>, 所以只要fork出來修改即可, 因此我從<a href="http://bit.ly/RVJcUf">Node.js buildpack</a> fork出一個新的<a href="http://bit.ly/RVJf2u">buidlpack</a>, 主要的修改是:<br/><br/><ol><li>安裝bower</li><li>找出所有的component.json並用&quot;bower install&quot;安裝套件</li></ol><div>本想說 &ldquo;1&rdquo; 應該蠻簡單的, 因為bower也是用node.js開發的, 應該只要用npm install bower就搞定了, 但事實是, 這樣會碰壁, 因為bower採用了<a href="http://bit.ly/Js8SYF">lodash</a> , lodash跟Heroku的npm似乎八字不合, 安裝過程到lodash的post-install就會失敗, 也沒明顯的錯誤, 只說這應該是套件問題, 而去查了lodash, 也有人報過類似的issue, 但作者卻以lodash沒問題應該是npm的問題把這issue給關了(鬼打牆?), 但:</div><div><ul><li>自己電腦上安裝bower或lodash都沒問題</li><li>在自己的package.json加上lodash, deploy到Heroku也一樣掛</li><li>在package.json裡設定engine裡的npm版本到最新的1.1.65(跟自己電腦上一樣版本), 也一樣不行</li></ul></div><br/>那&hellip;就不得不懷疑是npm問題了, 查了原本buildpack寫的, Heroku的node.js和npm其實是拿他們自己放在S3的binary package來安裝的, 可疑!<br/><br/>因此就使用了下一招 - 用npm來裝npm<br/><br/>用Heroku系統內的npm來裝npm是可行的, npm install npm的結果是, 會有一份最新的npm被安裝到node_modules底下, 可以用&quot;node_modules/.bin/npm&quot;來呼叫這版本, 因此就加上了:<br/><blockquote class="tr_bq"><i>node_modules/.bin/npm install bower</i></blockquote>Bingo! 這樣可行, bower一樣被安裝到 node_modules/.bin底下, 加上 &ldquo;2&quot;的邏輯到&quot;bin/compile&quot;後就大功告成了,<br/><br/>有修改的部份只有<a href="http://bit.ly/RVJf2w">&quot;bin/compile&rdquo;</a>, 比對一下commit history就可以知道我修改過啥, 中間有做了很多實驗, 所以有不少垃圾commits, 可以忽略<br/><br/>如果有需要這版本buildpack, 也歡迎利用:<br/><h3><a href="http://bit.ly/RVJf2u">http://bit.ly/RVJf2u</a></h3><br/><br/><br/><div id="blogsy_footer" style="clear: both; font-size: small; text-align: right;"><a href="http://bit.ly/jKo32O" target="_blank"><img alt="在Blogsy發表的" height="20" src="http://bit.ly/Nh8z1A" style="margin-right: 5px; vertical-align: middle;" width="20"/>在Blogsy發表的</a></div><br/><br/>
via Blogger <a href="http://bit.ly/WAoUr6">http://bit.ly/WAoUr6</a>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://blog.jln.co/tags/#IFTTT" title="Pages tagged IFTTT" class="tag"><span class="term">IFTTT</span></a><a href="http://blog.jln.co/tags/#Blogger" title="Pages tagged Blogger" class="tag"><span class="term">Blogger</span></a><a href="http://blog.jln.co/tags/#nodejs" title="Pages tagged nodejs" class="tag"><span class="term">nodejs</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.jln.co/nodejs-%E5%9C%A8heroku%E4%B8%8A%E7%94%A8bower%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E7%AC%AC%E4%B8%89%E6%96%B9%E5%85%83%E4%BB%B6/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://blog.jln.co/nodejs-%E5%9C%A8heroku%E4%B8%8A%E7%94%A8bower%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E7%AC%AC%E4%B8%89%E6%96%B9%E5%85%83%E4%BB%B6/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://blog.jln.co/nodejs-%E5%9C%A8heroku%E4%B8%8A%E7%94%A8bower%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E7%AC%AC%E4%B8%89%E6%96%B9%E5%85%83%E4%BB%B6/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="http://blog.jln.co/nodejs-%E7%94%A8npm%E5%AE%89%E8%A3%9D%E6%94%BE%E5%9C%A8github%E4%B8%8A%E7%9A%84module/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://blog.jln.co/heyblogtest/" title="Hey blog test">Hey blog test</a></h3>
      <p>This is to test my own blog##### header 1#### header 2```javascriptconsole.log("111")```*test***test**##### Header1 {#ID1}#### Header2 ##...&hellip; <a href="http://blog.jln.co/heyblogtest/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="http://blog.jln.co/%E7%AD%86%E8%A8%98-%E7%A7%BB%E6%A4%8Dparse-push/" title="[筆記] 移植Parse Push">[筆記] 移植Parse Push</a></h4>
        <span>Published on February 25, 2016</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="http://blog.jln.co/%E7%AD%86%E8%A8%98-%E8%A2%AB%E5%86%A4%E6%9E%89%E7%9A%84mongodb/" title="[筆記] 被冤枉的MongoDB">[筆記] 被冤枉的MongoDB</a></h4>
        <span>Published on February 18, 2016</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Julian Shen. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://blog.jln.co/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://blog.jln.co/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79243751-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'julianshen'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
