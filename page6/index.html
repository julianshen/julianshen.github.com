<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>朱隸安貓囈語錄 &#8211; Le murmure de Julian</title>
<meta name="description" content="朱隸安貓囈語錄">
<meta name="keywords" content="java, android, julianshen, backend, blog, golang, swift">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://blog.jln.co/images/bkg2.jpg">

<meta name="twitter:title" content="朱隸安貓囈語錄">
<meta name="twitter:description" content="朱隸安貓囈語錄">
<meta name="twitter:creator" content="@jlnshen">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="朱隸安貓囈語錄">
<meta property="og:description" content="朱隸安貓囈語錄">
<meta property="og:url" content="http://blog.jln.co/page6/">
<meta property="og:site_name" content="Le murmure de Julian">
<meta name="og:image" content="http://blog.jln.co/images/avatar.png">
<meta name="google-site-verification" content="Fwa4TQMXvroZpNT7rrwHzdf-rWBe1RDuTu75Enx_DWA">



<link rel="canonical" href="http://blog.jln.co/page6/">
<link href="http://blog.jln.co/feed.xml" type="application/atom+xml" rel="alternate" title="Le murmure de Julian Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://blog.jln.co/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://blog.jln.co/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://blog.jln.co/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://blog.jln.co/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://blog.jln.co/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://blog.jln.co/images/apple-touch-icon-144x144-precomposed.png">



  
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1789797875470932",
        enable_page_level_ads: true
    });
    </script>
  

</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://blog.jln.co/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://blog.jln.co/images/avatar.png" alt="Julian Shen photo" class="author-photo">
					<h4>Julian Shen</h4>
					<p>software deverloper</p>
				</li>
				<li>
					<a href="mailto:julianshen22@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/jlnshen"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/julianshen"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				
				<li>
					<a href="https://linkedin.com/in/julianshen"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/julianshen"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				<li>
					<a href="https://instagram.com/julianshen"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
				</li>
				<li>
					<a href="https://www.flickr.com/photos/julianshen"><i class="fa fa-fw fa-flickr"></i> Flickr</a>
				</li>
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://blog.jln.co/posts/">All Posts</a></li>
				<li><a href="http://blog.jln.co/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img src="http://blog.jln.co/images/bkg2.jpg" alt="朱隸安貓囈語錄">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Le murmure de Julian</h1>
      <h2>朱隸安貓囈語錄</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-10-31T08:49:18+08:00"><a href="http://blog.jln.co/%E6%B7%BA%E8%AB%87social-feed-%E5%A4%9A%E6%9C%8D%E5%8B%99%E5%BD%99%E6%95%B4%E5%BC%8F%E7%9A%84social-feed-client/">October 31, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://blog.jln.co/about/" title="About Julian Shen">Julian Shen</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~5 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://blog.jln.co/%E6%B7%BA%E8%AB%87social-feed-%E5%A4%9A%E6%9C%8D%E5%8B%99%E5%BD%99%E6%95%B4%E5%BC%8F%E7%9A%84social-feed-client/" rel="bookmark" title="淺談Social Feed - 多服務彙整式的social feed [Client]" itemprop="url">淺談Social Feed - 多服務彙整式的social feed [Client]</a></h1>
    
  </header>
  <div class="entry-content">
    <p>出去放空玩一陣子了, 也該接下來整理一下剩下的東西了, 這篇主要要來談一下彙整式的social feed (aggregation feeds), 這功用是什麼呢?
由於現代人擁有了很多社群網路的帳號, 但如果要一個個網站或App開著看才能看到所有的動態, 未免太累了, 因此變有這種彙整式的服務出現, 讓使用者在一個地方可以看到所有的社群動態</p>

<p>這種形態的應用, 有幾個有代表性的, <a href="/淺談social-feed-概念篇/">前一篇的概念篇</a>裡所提到的<a href="https://zh.wikipedia.org/wiki/FriendFeed">Friendfeed</a>,
還有就是<a href="https://flipboard.com">Flipboard</a>, 另外就是HTC的<a href="http://mobile.htc.com/learnmore/desires/eng/howtos/GUID-89A364D2-2043-46BD-9249-AA7BE00577A9.html">Friend stream</a>和<a href="http://www.htc.com/tw/support/htc-one-m8/howto/cat_71459.html">Blinkfeed</a> (私心提這兩個我所參與過的)</p>

<p><img src="http://farm4.static.flickr.com/3607/3418465682_acacbe7147_o.jpg" alt="Friendfeed" />
<img src="/images/posts/flipboard_i1.png" alt="Flipboard" /></p>
<div class="video"><figure><iframe width="640" height="480" src="//www.youtube.com/embed/6Ss4bM1XmTA" frameborder="0" allowfullscreen=""></iframe></figure></div>
<div class="video"><figure><iframe width="640" height="480" src="//www.youtube.com/embed/GdJInzTJI0U" frameborder="0" allowfullscreen=""></iframe></figure></div>

<p>前兩者跟後兩者的差異是在於, 前兩者在彙整social feeds是在server端, 所以client僅需要從server抓取彙整過的資料下來就好, 複雜度在於服務端並不是在client app,
而Blinkfeed跟Friendstream的差異點則是在Friendstream整合了跟社群網路相關的動態, Blinkfeed則是多了新聞的部分, 後來實作的方式為了有更多的彈性, 底層架構的部分也有所改變,
這篇會稍微提到如果是在Server端實作的一些可能做法, 但主要還是著重在client端實作的問題</p>

<p>做這樣一個東西, 不就是去呼叫各社群網路的API抓資料, 回來全部混在一起就好了? 如果單純只是實作一個”可以用的”, 那這樣可能就可以了, 但實際上還是有些問題存在, 如</p>

<ol>
  <li>各家API雖類似但個家還是有很多不同</li>
  <li>各家server回應時間不盡相同</li>
  <li>資料時間線交錯問題</li>
  <li>資料更新問題</li>
  <li>網路流量問題</li>
</ol>

<p>在看這些東西之前, 先來看看各家API的部分</p>

<h3 id="social-feed-api">Social Feed API</h3>

<p>很多社群網站都有提供公開的API讓你去獲取使用者的Social feeds, API定義各家各有不同, 但特色都一致的, 也就是大家都是以REST API設計為主, 採資料拉取(Pull)的方式, 分頁(pagination)的方式</p>

<h4 id="rest-polling-and-pagination">REST, Polling, and Pagination</h4>

<p>因為採用了REST API的定義方式, 所以資料傳輸上大多(幾乎是全部了啦)以JSON為主, 用REST + JSON的好處是簡單, 彈性, 資料也比較適合閱讀, 不過, 別騙人了啦, 你有多少次會直接去閱讀JSON, 除非你要做啥hacking,
這連帶的也有人在實作client直接把JSON資料拿來儲存或暫存, 不過, 帶來的壞處是, 解析JSON其實並不是很經濟(後面會再稍提一下)</p>

<p>前面也有提到, 這樣的API設計是以”拉取”(Pull)為主, 也就是server並不會主動給你最新的資料, 而是必須你的client自行呼叫API去取得, 因此要隨時保持有最新的動態,
必須要不斷的輪詢(polling) server, 這其實也是相當不經濟的做法, 就算在熱門如Facebook, Twitter, 使用者的Social feeds不見得隨時會有最新的動態,
因此多久的輪詢間隔才是最好的, 這會是一個很頭痛的事, 太過頻繁易造成浪費, 也會造成server的負擔, 太久則會造成使用者看到的動態並不總是會是最新的,
其實少數像是Twitter, 有提供所謂的Streaming API, 這種就不是以拉取為主, 而是server會主動更新資料</p>

<p>一般來說, 社群網站上面”跟隨”(Follow)了越多人, 看得到的動態越多, 總不可能每次抓取資料就從頭一筆給到最新的一筆, 這樣的話, 不但花時間, 浪費流量, 也增加了server的負擔,
所以絕大部分的API, 都是從最新的往回給一定數量(比如說25則)的內容, 這樣稱之為一頁, 因此如果使用者需要往回捲回之前的資料, 就再抓取再前面一個分頁, 這樣的設計就是分頁(Pagination),
分頁的問題點在於, 社群動態的最頂頭的部分常常會再有更新的動態加入, 導致分頁會整個位移, 像下圖, 這樣會導致client有可能抓取到重複的資料, 甚至時間線錯亂</p>

<p><img src="/images/posts/pagination.001.jpeg" alt="" /></p>

<h4 id="twitter-api">Twitter API</h4>

<p>先來看看<a href="https://dev.twitter.com/rest/public/timelines">Twitter API</a>的例子, 這邊就有很詳細地解釋前述的Pagination的問題, 並且講解如何用max_id和since_id來解決這一問題</p>

<p>Twitter在這部分經驗豐富, 他們用的解法是以”id”, 有些社群網站的since會用”時間”, 用時間是不好的做法, 因為就算你時間記錄到微秒, 還是很有可能有兩則以上的動態可能是相同時間的, 這樣錯亂的問題一樣存在</p>

<p>Twitter在抓取使用者的social feed用的API是<a href="https://dev.twitter.com/rest/reference/get/statuses/home_timeline">“GET statuses/home_timeline.json”</a>,
回傳的資料是一個Tweets的陣列如下:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">"coordinates"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"truncated"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"created_at"</span><span class="p">:</span> <span class="s2">"Tue Aug 28 21:16:23 +0000 2012"</span><span class="p">,</span>
    <span class="s2">"favorited"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"id_str"</span><span class="p">:</span> <span class="s2">"240558470661799936"</span><span class="p">,</span>
    <span class="s2">"in_reply_to_user_id_str"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"entities"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"urls"</span><span class="p">:</span> <span class="p">[</span>

      <span class="p">],</span>
      <span class="s2">"hashtags"</span><span class="p">:</span> <span class="p">[</span>

      <span class="p">],</span>
      <span class="s2">"user_mentions"</span><span class="p">:</span> <span class="p">[</span>

      <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">"text"</span><span class="err">:</span> <span class="s2">"just another test"</span><span class="p">,</span>
    <span class="s2">"contributors"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"id"</span><span class="err">:</span> <span class="mi">240558470661799936</span><span class="p">,</span>
    <span class="s2">"retweet_count"</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">"in_reply_to_status_id_str"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"geo"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"retweeted"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"in_reply_to_user_id"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"place"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"source"</span><span class="err">:</span> <span class="s2">"OAuth Dancer Reborn"</span><span class="p">,</span>
    <span class="s2">"user"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"name"</span><span class="err">:</span> <span class="s2">"OAuth Dancer"</span><span class="p">,</span>
      <span class="s2">"profile_sidebar_fill_color"</span><span class="err">:</span> <span class="s2">"DDEEF6"</span><span class="p">,</span>
      <span class="s2">"profile_background_tile"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"profile_sidebar_border_color"</span><span class="err">:</span> <span class="s2">"C0DEED"</span><span class="p">,</span>
      <span class="s2">"profile_image_url"</span><span class="err">:</span> <span class="s2">"http://a0.twimg.com/profile_images/730275945/oauth-dancer_normal.jpg"</span><span class="p">,</span>
      <span class="s2">"created_at"</span><span class="err">:</span> <span class="s2">"Wed Mar 03 19:37:35 +0000 2010"</span><span class="p">,</span>
      <span class="s2">"location"</span><span class="err">:</span> <span class="s2">"San Francisco, CA"</span><span class="p">,</span>
      <span class="s2">"follow_request_sent"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"id_str"</span><span class="err">:</span> <span class="s2">"119476949"</span><span class="p">,</span>
      <span class="s2">"is_translator"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"profile_link_color"</span><span class="err">:</span> <span class="s2">"0084B4"</span><span class="p">,</span>
      <span class="s2">"entities"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"url"</span><span class="err">:</span> <span class="p">{</span>
          <span class="s2">"urls"</span><span class="err">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">"expanded_url"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
              <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"http://bit.ly/oauth-dancer"</span><span class="p">,</span>
              <span class="s2">"indices"</span><span class="p">:</span> <span class="p">[</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="mi">26</span>
              <span class="p">],</span>
              <span class="s2">"display_url"</span><span class="p">:</span> <span class="kc">null</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"description"</span><span class="err">:</span> <span class="kc">null</span>
      <span class="p">},</span>
      <span class="s2">"default_profile"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"url"</span><span class="err">:</span> <span class="s2">"http://bit.ly/oauth-dancer"</span><span class="p">,</span>
      <span class="s2">"contributors_enabled"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"favourites_count"</span><span class="err">:</span> <span class="mi">7</span><span class="p">,</span>
      <span class="s2">"utc_offset"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="s2">"profile_image_url_https"</span><span class="err">:</span> <span class="s2">"https://si0.twimg.com/profile_images/730275945/oauth-dancer_normal.jpg"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="err">:</span> <span class="mi">119476949</span><span class="p">,</span>
      <span class="s2">"listed_count"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">"profile_use_background_image"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"profile_text_color"</span><span class="err">:</span> <span class="s2">"333333"</span><span class="p">,</span>
      <span class="s2">"followers_count"</span><span class="err">:</span> <span class="mi">28</span><span class="p">,</span>
      <span class="s2">"lang"</span><span class="err">:</span> <span class="s2">"en"</span><span class="p">,</span>
      <span class="s2">"protected"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"geo_enabled"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"notifications"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="err">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="s2">"profile_background_color"</span><span class="err">:</span> <span class="s2">"C0DEED"</span><span class="p">,</span>
      <span class="s2">"verified"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"time_zone"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="s2">"profile_background_image_url_https"</span><span class="err">:</span> <span class="s2">"https://si0.twimg.com/profile_background_images/80151733/oauth-dance.png"</span><span class="p">,</span>
      <span class="s2">"statuses_count"</span><span class="err">:</span> <span class="mi">166</span><span class="p">,</span>
      <span class="s2">"profile_background_image_url"</span><span class="err">:</span> <span class="s2">"http://a0.twimg.com/profile_background_images/80151733/oauth-dance.png"</span><span class="p">,</span>
      <span class="s2">"default_profile_image"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"friends_count"</span><span class="err">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="s2">"following"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"show_all_inline_media"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"screen_name"</span><span class="err">:</span> <span class="s2">"oauth_dancer"</span>
    <span class="p">},</span>
    <span class="s2">"in_reply_to_screen_name"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"in_reply_to_status_id"</span><span class="err">:</span> <span class="kc">null</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">"coordinates"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"coordinates"</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">-</span><span class="mf">122.25831</span><span class="p">,</span>
        <span class="mf">37.871609</span>
      <span class="p">],</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"Point"</span>
    <span class="p">},</span>
    <span class="s2">"truncated"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"created_at"</span><span class="err">:</span> <span class="s2">"Tue Aug 28 21:08:15 +0000 2012"</span><span class="p">,</span>
    <span class="s2">"favorited"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"id_str"</span><span class="err">:</span> <span class="s2">"240556426106372096"</span><span class="p">,</span>
    <span class="s2">"in_reply_to_user_id_str"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"entities"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"urls"</span><span class="err">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">"expanded_url"</span><span class="p">:</span> <span class="s2">"http://blogs.ischool.berkeley.edu/i290-abdt-s12/"</span><span class="p">,</span>
          <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"http://t.co/bfj7zkDJ"</span><span class="p">,</span>
          <span class="s2">"indices"</span><span class="p">:</span> <span class="p">[</span>
            <span class="mi">79</span><span class="p">,</span>
            <span class="mi">99</span>
          <span class="p">],</span>
          <span class="s2">"display_url"</span><span class="p">:</span> <span class="s2">"blogs.ischool.berkeley.edu/i290-abdt-s12/"</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">"hashtags"</span><span class="err">:</span> <span class="p">[</span>

      <span class="p">],</span>
      <span class="s2">"user_mentions"</span><span class="err">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Cal"</span><span class="p">,</span>
          <span class="s2">"id_str"</span><span class="p">:</span> <span class="s2">"17445752"</span><span class="p">,</span>
          <span class="s2">"id"</span><span class="p">:</span> <span class="mi">17445752</span><span class="p">,</span>
          <span class="s2">"indices"</span><span class="p">:</span> <span class="p">[</span>
            <span class="mi">60</span><span class="p">,</span>
            <span class="mi">64</span>
          <span class="p">],</span>
          <span class="s2">"screen_name"</span><span class="p">:</span> <span class="s2">"Cal"</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Othman Laraki"</span><span class="p">,</span>
          <span class="s2">"id_str"</span><span class="p">:</span> <span class="s2">"20495814"</span><span class="p">,</span>
          <span class="s2">"id"</span><span class="p">:</span> <span class="mi">20495814</span><span class="p">,</span>
          <span class="s2">"indices"</span><span class="p">:</span> <span class="p">[</span>
            <span class="mi">70</span><span class="p">,</span>
            <span class="mi">77</span>
          <span class="p">],</span>
          <span class="s2">"screen_name"</span><span class="p">:</span> <span class="s2">"othman"</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">"text"</span><span class="err">:</span> <span class="s2">"lecturing at the \"analyzing big data with twitter\" class at @cal with @othman  http://t.co/bfj7zkDJ"</span><span class="p">,</span>
    <span class="s2">"contributors"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"id"</span><span class="err">:</span> <span class="mi">240556426106372096</span><span class="p">,</span>
    <span class="s2">"retweet_count"</span><span class="err">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">"in_reply_to_status_id_str"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"geo"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"coordinates"</span><span class="err">:</span> <span class="p">[</span>
        <span class="mf">37.871609</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">122.25831</span>
      <span class="p">],</span>
      <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"Point"</span>
    <span class="p">},</span>
    <span class="s2">"retweeted"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"possibly_sensitive"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"in_reply_to_user_id"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"place"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"name"</span><span class="err">:</span> <span class="s2">"Berkeley"</span><span class="p">,</span>
      <span class="s2">"country_code"</span><span class="err">:</span> <span class="s2">"US"</span><span class="p">,</span>
      <span class="s2">"country"</span><span class="err">:</span> <span class="s2">"United States"</span><span class="p">,</span>
      <span class="s2">"attributes"</span><span class="err">:</span> <span class="p">{</span>
      <span class="p">},</span>
      <span class="s2">"url"</span><span class="err">:</span> <span class="s2">"http://api.twitter.com/1/geo/id/5ef5b7f391e30aff.json"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"5ef5b7f391e30aff"</span><span class="p">,</span>
      <span class="s2">"bounding_box"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"coordinates"</span><span class="err">:</span> <span class="p">[</span>
          <span class="p">[</span>
            <span class="p">[</span>
              <span class="o">-</span><span class="mf">122.367781</span><span class="p">,</span>
              <span class="mf">37.835727</span>
            <span class="p">],</span>
            <span class="p">[</span>
              <span class="o">-</span><span class="mf">122.234185</span><span class="p">,</span>
              <span class="mf">37.835727</span>
            <span class="p">],</span>
            <span class="p">[</span>
              <span class="o">-</span><span class="mf">122.234185</span><span class="p">,</span>
              <span class="mf">37.905824</span>
            <span class="p">],</span>
            <span class="p">[</span>
              <span class="o">-</span><span class="mf">122.367781</span><span class="p">,</span>
              <span class="mf">37.905824</span>
            <span class="p">]</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"Polygon"</span>
      <span class="p">},</span>
      <span class="s2">"full_name"</span><span class="err">:</span> <span class="s2">"Berkeley, CA"</span><span class="p">,</span>
      <span class="s2">"place_type"</span><span class="err">:</span> <span class="s2">"city"</span>
    <span class="p">},</span>
    <span class="s2">"source"</span><span class="err">:</span> <span class="s2">"Safari on iOS"</span><span class="p">,</span>
    <span class="s2">"user"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"name"</span><span class="err">:</span> <span class="s2">"Raffi Krikorian"</span><span class="p">,</span>
      <span class="s2">"profile_sidebar_fill_color"</span><span class="err">:</span> <span class="s2">"DDEEF6"</span><span class="p">,</span>
      <span class="s2">"profile_background_tile"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"profile_sidebar_border_color"</span><span class="err">:</span> <span class="s2">"C0DEED"</span><span class="p">,</span>
      <span class="s2">"profile_image_url"</span><span class="err">:</span> <span class="s2">"http://a0.twimg.com/profile_images/1270234259/raffi-headshot-casual_normal.png"</span><span class="p">,</span>
      <span class="s2">"created_at"</span><span class="err">:</span> <span class="s2">"Sun Aug 19 14:24:06 +0000 2007"</span><span class="p">,</span>
      <span class="s2">"location"</span><span class="err">:</span> <span class="s2">"San Francisco, California"</span><span class="p">,</span>
      <span class="s2">"follow_request_sent"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"id_str"</span><span class="err">:</span> <span class="s2">"8285392"</span><span class="p">,</span>
      <span class="s2">"is_translator"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"profile_link_color"</span><span class="err">:</span> <span class="s2">"0084B4"</span><span class="p">,</span>
      <span class="s2">"entities"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"url"</span><span class="err">:</span> <span class="p">{</span>
          <span class="s2">"urls"</span><span class="err">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">"expanded_url"</span><span class="p">:</span> <span class="s2">"http://about.me/raffi.krikorian"</span><span class="p">,</span>
              <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"http://t.co/eNmnM6q"</span><span class="p">,</span>
              <span class="s2">"indices"</span><span class="p">:</span> <span class="p">[</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="mi">19</span>
              <span class="p">],</span>
              <span class="s2">"display_url"</span><span class="p">:</span> <span class="s2">"about.me/raffi.krikorian"</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"description"</span><span class="err">:</span> <span class="p">{</span>
          <span class="s2">"urls"</span><span class="err">:</span> <span class="p">[</span>

          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">"default_profile"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"url"</span><span class="err">:</span> <span class="s2">"http://t.co/eNmnM6q"</span><span class="p">,</span>
      <span class="s2">"contributors_enabled"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"favourites_count"</span><span class="err">:</span> <span class="mi">724</span><span class="p">,</span>
      <span class="s2">"utc_offset"</span><span class="err">:</span> <span class="o">-</span><span class="mi">28800</span><span class="p">,</span>
      <span class="s2">"profile_image_url_https"</span><span class="err">:</span> <span class="s2">"https://si0.twimg.com/profile_images/1270234259/raffi-headshot-casual_normal.png"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="err">:</span> <span class="mi">8285392</span><span class="p">,</span>
      <span class="s2">"listed_count"</span><span class="err">:</span> <span class="mi">619</span><span class="p">,</span>
      <span class="s2">"profile_use_background_image"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"profile_text_color"</span><span class="err">:</span> <span class="s2">"333333"</span><span class="p">,</span>
      <span class="s2">"followers_count"</span><span class="err">:</span> <span class="mi">18752</span><span class="p">,</span>
      <span class="s2">"lang"</span><span class="err">:</span> <span class="s2">"en"</span><span class="p">,</span>
      <span class="s2">"protected"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"geo_enabled"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"notifications"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="err">:</span> <span class="s2">"Director of @twittereng's Platform Services. I break things."</span><span class="p">,</span>
      <span class="s2">"profile_background_color"</span><span class="err">:</span> <span class="s2">"C0DEED"</span><span class="p">,</span>
      <span class="s2">"verified"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"time_zone"</span><span class="err">:</span> <span class="s2">"Pacific Time (US &amp; Canada)"</span><span class="p">,</span>
      <span class="s2">"profile_background_image_url_https"</span><span class="err">:</span> <span class="s2">"https://si0.twimg.com/images/themes/theme1/bg.png"</span><span class="p">,</span>
      <span class="s2">"statuses_count"</span><span class="err">:</span> <span class="mi">5007</span><span class="p">,</span>
      <span class="s2">"profile_background_image_url"</span><span class="err">:</span> <span class="s2">"http://a0.twimg.com/images/themes/theme1/bg.png"</span><span class="p">,</span>
      <span class="s2">"default_profile_image"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"friends_count"</span><span class="err">:</span> <span class="mi">701</span><span class="p">,</span>
      <span class="s2">"following"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"show_all_inline_media"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"screen_name"</span><span class="err">:</span> <span class="s2">"raffi"</span>
    <span class="p">},</span>
    <span class="s2">"in_reply_to_screen_name"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"in_reply_to_status_id"</span><span class="err">:</span> <span class="kc">null</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">"coordinates"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"truncated"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"created_at"</span><span class="p">:</span> <span class="s2">"Tue Aug 28 19:59:34 +0000 2012"</span><span class="p">,</span>
    <span class="s2">"favorited"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"id_str"</span><span class="p">:</span> <span class="s2">"240539141056638977"</span><span class="p">,</span>
    <span class="s2">"in_reply_to_user_id_str"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"entities"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"urls"</span><span class="p">:</span> <span class="p">[</span>

      <span class="p">],</span>
      <span class="s2">"hashtags"</span><span class="p">:</span> <span class="p">[</span>

      <span class="p">],</span>
      <span class="s2">"user_mentions"</span><span class="p">:</span> <span class="p">[</span>

      <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">"text"</span><span class="err">:</span> <span class="s2">"You'd be right more often if you thought you were wrong."</span><span class="p">,</span>
    <span class="s2">"contributors"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"id"</span><span class="err">:</span> <span class="mi">240539141056638977</span><span class="p">,</span>
    <span class="s2">"retweet_count"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"in_reply_to_status_id_str"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"geo"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"retweeted"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">"in_reply_to_user_id"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"place"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"source"</span><span class="err">:</span> <span class="s2">"web"</span><span class="p">,</span>
    <span class="s2">"user"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"name"</span><span class="err">:</span> <span class="s2">"Taylor Singletary"</span><span class="p">,</span>
      <span class="s2">"profile_sidebar_fill_color"</span><span class="err">:</span> <span class="s2">"FBFBFB"</span><span class="p">,</span>
      <span class="s2">"profile_background_tile"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"profile_sidebar_border_color"</span><span class="err">:</span> <span class="s2">"000000"</span><span class="p">,</span>
      <span class="s2">"profile_image_url"</span><span class="err">:</span> <span class="s2">"http://a0.twimg.com/profile_images/2546730059/f6a8zq58mg1hn0ha8vie_normal.jpeg"</span><span class="p">,</span>
      <span class="s2">"created_at"</span><span class="err">:</span> <span class="s2">"Wed Mar 07 22:23:19 +0000 2007"</span><span class="p">,</span>
      <span class="s2">"location"</span><span class="err">:</span> <span class="s2">"San Francisco, CA"</span><span class="p">,</span>
      <span class="s2">"follow_request_sent"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"id_str"</span><span class="err">:</span> <span class="s2">"819797"</span><span class="p">,</span>
      <span class="s2">"is_translator"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"profile_link_color"</span><span class="err">:</span> <span class="s2">"c71818"</span><span class="p">,</span>
      <span class="s2">"entities"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"url"</span><span class="err">:</span> <span class="p">{</span>
          <span class="s2">"urls"</span><span class="err">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">"expanded_url"</span><span class="p">:</span> <span class="s2">"http://www.rebelmouse.com/episod/"</span><span class="p">,</span>
              <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"http://t.co/Lxw7upbN"</span><span class="p">,</span>
              <span class="s2">"indices"</span><span class="p">:</span> <span class="p">[</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="mi">20</span>
              <span class="p">],</span>
              <span class="s2">"display_url"</span><span class="p">:</span> <span class="s2">"rebelmouse.com/episod/"</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"description"</span><span class="err">:</span> <span class="p">{</span>
          <span class="s2">"urls"</span><span class="err">:</span> <span class="p">[</span>

          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">"default_profile"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"url"</span><span class="err">:</span> <span class="s2">"http://t.co/Lxw7upbN"</span><span class="p">,</span>
      <span class="s2">"contributors_enabled"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"favourites_count"</span><span class="err">:</span> <span class="mi">15990</span><span class="p">,</span>
      <span class="s2">"utc_offset"</span><span class="err">:</span> <span class="o">-</span><span class="mi">28800</span><span class="p">,</span>
      <span class="s2">"profile_image_url_https"</span><span class="err">:</span> <span class="s2">"https://si0.twimg.com/profile_images/2546730059/f6a8zq58mg1hn0ha8vie_normal.jpeg"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="err">:</span> <span class="mi">819797</span><span class="p">,</span>
      <span class="s2">"listed_count"</span><span class="err">:</span> <span class="mi">340</span><span class="p">,</span>
      <span class="s2">"profile_use_background_image"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"profile_text_color"</span><span class="err">:</span> <span class="s2">"D20909"</span><span class="p">,</span>
      <span class="s2">"followers_count"</span><span class="err">:</span> <span class="mi">7126</span><span class="p">,</span>
      <span class="s2">"lang"</span><span class="err">:</span> <span class="s2">"en"</span><span class="p">,</span>
      <span class="s2">"protected"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"geo_enabled"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"notifications"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"description"</span><span class="err">:</span> <span class="s2">"Reality Technician, Twitter API team, synthesizer enthusiast; a most excellent adventure in timelines. I know it's hard to believe in something you can't see."</span><span class="p">,</span>
      <span class="s2">"profile_background_color"</span><span class="err">:</span> <span class="s2">"000000"</span><span class="p">,</span>
      <span class="s2">"verified"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"time_zone"</span><span class="err">:</span> <span class="s2">"Pacific Time (US &amp; Canada)"</span><span class="p">,</span>
      <span class="s2">"profile_background_image_url_https"</span><span class="err">:</span> <span class="s2">"https://si0.twimg.com/profile_background_images/643655842/hzfv12wini4q60zzrthg.png"</span><span class="p">,</span>
      <span class="s2">"statuses_count"</span><span class="err">:</span> <span class="mi">18076</span><span class="p">,</span>
      <span class="s2">"profile_background_image_url"</span><span class="err">:</span> <span class="s2">"http://a0.twimg.com/profile_background_images/643655842/hzfv12wini4q60zzrthg.png"</span><span class="p">,</span>
      <span class="s2">"default_profile_image"</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"friends_count"</span><span class="err">:</span> <span class="mi">5444</span><span class="p">,</span>
      <span class="s2">"following"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"show_all_inline_media"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"screen_name"</span><span class="err">:</span> <span class="s2">"episod"</span>
    <span class="p">},</span>
    <span class="s2">"in_reply_to_screen_name"</span><span class="err">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"in_reply_to_status_id"</span><span class="err">:</span> <span class="kc">null</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre>
</div>

<p>眼花撩亂了吧? 這邊先不細部探討每個部分的意義, 你只需要先知道, 這雖然看來很複雜, 但有一大半你做client時”並用不上!!!”
通常只會需要內文, 連結, 回文數量, 喜愛數量, 使用者基本資料(大概就ID, 名字, 圖像就已經差不多了)</p>

<h4 id="facebook-api">Facebook API</h4>

<p>Facebook有相當多的功能, 因此相較於Twitter, 他的API自然複雜很多, 這邊要看的還是只有<a href="https://developers.facebook.com/docs/graph-api/reference/v2.8/user/feed">User Feed</a>這部分,
不過似乎Facebook Graph API已經不再允許存取home timeline了, User Feed其實只能存取自己po的文</p>

<p>在處理Pagination上, Facebook API並不是很一致, 從<a href="https://developers.facebook.com/docs/graph-api/using-graph-api">這篇</a>來看, 有幾種分頁的形式:</p>

<ol>
  <li>游標型分頁</li>
  <li>時間型分頁</li>
  <li>位移型分頁</li>
</ol>

<p>並不是所有的API節點都支援這三種分頁型態, 例如”/user/albums”用的是游標型, 但User Feed用的是時間型, 時間型的缺點就是有可能會發生有相同時間的動態的問題, 但不管是哪一個類型
在Paging的資訊都會有一個previuos跟next的連結(如下), 因此不用太擔心要根據不同型態去組出URL這部分</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">//游標型分頁</span>
<span class="p">{</span>
  <span class="s2">"data"</span><span class="err">:</span><span class="p">[</span>
     
  <span class="p">],</span>
  <span class="s2">"paging"</span><span class="err">:</span><span class="p">{</span>
    <span class="s2">"cursors"</span><span class="err">:</span><span class="p">{</span>
      <span class="s2">"after"</span><span class="err">:</span><span class="s2">"MTAxNTExOTQ1MjAwNzI5NDE="</span><span class="p">,</span>
      <span class="s2">"before"</span><span class="err">:</span><span class="s2">"NDMyNzQyODI3OTQw"</span>
    <span class="p">},</span>
    <span class="s2">"previous"</span><span class="err">:</span><span class="s2">"https://graph.facebook.com/me/albums?limit=25&amp;before=NDMyNzQyODI3OTQw"</span>
    <span class="s2">"next"</span><span class="err">:</span><span class="s2">"https://graph.facebook.com/me/albums?limit=25&amp;after=MTAxNTExOTQ1MjAwNzI5NDE="</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//時間型分頁</span>
<span class="p">{</span>
  <span class="s2">"data"</span><span class="err">:</span><span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"真專業，還有空橋耶"</span><span class="p">,</span>
      <span class="s2">"created_time"</span><span class="p">:</span> <span class="s2">"2016-10-30T11:41:36+0000"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1129283437_10210116929056272"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"兄弟藍瘦香菇了"</span><span class="p">,</span>
      <span class="s2">"created_time"</span><span class="p">:</span> <span class="s2">"2016-10-29T12:45:58+0000"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1129283437_10210105741976602"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"又被拖著跑了"</span><span class="p">,</span>
      <span class="s2">"created_time"</span><span class="p">:</span> <span class="s2">"2016-10-29T06:39:29+0000"</span><span class="p">,</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1129283437_10210103402598119"</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">"paging"</span><span class="err">:</span><span class="p">{</span>
    <span class="s2">"previous"</span><span class="err">:</span><span class="s2">"https://graph.facebook.com/me/feed?limit=25&amp;since=1364849754"</span><span class="p">,</span>
    <span class="s2">"next"</span><span class="err">:</span><span class="s2">"https://graph.facebook.com/me/feed?limit=25&amp;until=1364587774"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>在資料內容方面, Facebook回應的資料比起Twitter反而就相當的精簡, 這是有助於減低回應時間的(response time)</p>

<h3 id="section">時間線回朔問題</h3>

<p>剛提到Pagination時有講到在Client的設計上, 在使用者往回滑完一頁時必須要再獲取上一頁的資料, 這在單一資料源的時候問題不大, 但對彙整式的social feed, 尤其完全在Client端實作的, 會有這樣一個問題</p>

<p>先來看看下圖:</p>

<p><img src="/images/posts/aggregation.002.jpeg" alt="" /></p>

<p>假設我們有S1, S2, S3, S4四個服務的動態要整合, 垂直每個線段是每次API call抓取到的資料的時間段(每個分頁的匙間段)</p>

<p>如果我們先不考慮S2-S4, 而是只有一個S1, 第一次載入的分頁內容的時間點在t1-t2間, 所以照理來說當使用者滑到快t2時, 要再發出一個新的API call抓取下一個分頁, 也就是t3-t5這段,
但如果把S2-S4列入考慮後, 會發現, 當第一次從四個服務那邊取得資料, 資料涵括的時間是從t1-t9, 如果什麼都不做處理而是照前面的邏輯來看, 必須要使用者滑到快t9時,
才會第二次抓取資料, 但由於第一次抓取時, S1缺了t2-t9間的資料, S2缺了t3之後的, S4的資料也只到t4, 因此第二次抓取資料時, 會造成這三者的資料往前回填,
這在UI顯示上會是一個比較大的災難</p>

<p>因此, 以這圖來說, 第一次抓取完畢後, UI上只能顯示t1-t2間的資料, 使用者滑到t2時, 就必須觸發第二次資料的抓取, 但以這例子來說, 其實第二次是不需要包含S3
的, 因為它第一次抓取的資料時間還在t5之後, 所以這邊如果能夠做省略, 而不是每次抓取資料都包含了S1-S4, 那可以省卻不少回應時間</p>

<h3 id="data-normalization">資料格式的一致化(Data normalization)</h3>

<p>剛剛看了Twitter, Facebook兩個API, 它的資料格式雖然都是JSON, 但內容差異很大, 但實際上來說, 以上次那篇的一張圖來做解釋:</p>

<p><img src="/images/posts/post1021_facebook2.jpg" alt="" /></p>

<p>從這張圖可以發現, 我們需要的資料並不多, 即使各家型態有所不同(例如Twitter重文字, Instagram是以圖為主), 我們還是可以歸納出我們UI所需要顯示的型態有哪些類別,
因此我們需要的也只是顯示UI所需要的部分而已, 所以我們可以把這些不同來源的資料格式一致化成同一種我們所需要的資料格式</p>

<p>那為何需要先一致化呢? 每次API抓回來的資料解析完直接顯示到UI上不就好了? 一般這樣的App的UI設計上, 會讓使用者一直捲頁, 因此你還是會需要把舊資料先暫存,
不管是在記憶體或是在資料庫內, 這樣使用者回捲再多也不需要再從server抓取舊資料, 但你如果把原本資料原封不動的拿來存, 像Twitter那個就會存了很多不必要的資料,
如果更偷懶直接存JSON, 那就會是效率問題了, 解析JSON過程中其實會產生不少垃圾, 效率也不高, 可能會影響UI的效能, 因此如果能夠在一開始把解析完的資料序列化到資料庫內,
會是比較理想, 因為你只需要從資料庫取相對應解析完的資料就好, 不用再一次解析JSON</p>

<h3 id="section-1">背景更新</h3>

<p>偷偷在背景更新動態是一種解決時間線回朔這個問題的方法, 因為所有資料都預先抓回資料庫, 所以也不需要煩惱什麼時後該去抓下一個分頁, 每個服務都可以獨立抓取, 丟到本地的資料庫彙整就好
,在使用者使用程式時, 也不需要解析太多JSON, 但這帶來一個缺點是因為在背景抓資料, 會有浪費頻寬的問題, 假設使用者一天最多只看了50則動態, 但一天其實會產生一百則, 那就會有50則的資訊量是浪費了,
再加上Social API都是用輪詢(polling)的方式, 並不是會時時有資料, 所以常常很多API calls其實是不需要也浪費的</p>

<h3 id="friendfeed">那Friendfeed的做法?</h3>

<p>Facebook的前CTO, 也是Friendfeed創辦人之一的Brett Taylor在這篇 <a href="https://www.quora.com/How-do-sites-such-as-FriendFeed-and-Flipboard-scale-out-their-social-data-aggregators">How do sites such as FriendFeed and Flipboard scale out their social data-aggregators?</a>
的回答可窺知一二</p>

<p>在server端的做法就像背景更新差不多, 定期用crawler發api去抓取各服務的資料, 然後塞到資料庫內, 因此就沒有時間線回朔的問題了, 但問題就在於抓取的間隔, 因此在server端實作的難題就是該怎樣去取這間隔,
在OSCON 2008有一篇<a href="http://cdn.oreillystatic.com/en/assets/1/event/12/Beyond%20REST_%20Building%20Data%20Services%20with%20XMPP%20PubSub%20Presentation.pdf">Beyond REST? Building Data Services with XMPP PubSub</a>有提到:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>on july 21st, 2008, they friendfeed crawled flickr 2.9 million times. to get the latest photos of 45,754 users of which 6,721 of that 45,754 visited Flickr in that 24 hour period, and could have *potentially* uploaded a photo. 
- Beyond REST? Building data services with XMPP PubSub (Evan Henshaw-Plath, ENTP.com, Kellan Elliott-McCrea, Flickr.com)
</code></pre>
</div>

<p>但實際上來說, 並沒有那麼多的更新, 也不需要那麼頻繁的去抓取, 但這是這類型的API先天的缺陷, 也不是Friendfeed的問題, 或許在下一篇講一下怎麼設計API來改善這狀況</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-10-20T09:07:59+08:00"><a href="http://blog.jln.co/%E6%B7%BA%E8%AB%87social-feed-%E6%A6%82%E5%BF%B5%E7%AF%87/">October 20, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://blog.jln.co/about/" title="About Julian Shen">Julian Shen</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://blog.jln.co/%E6%B7%BA%E8%AB%87social-feed-%E6%A6%82%E5%BF%B5%E7%AF%87/" rel="bookmark" title="淺談Social Feed - 概念篇" itemprop="url">淺談Social Feed - 概念篇</a></h1>
    
  </header>
  <div class="entry-content">
    <p>如果要找出一個我過去幾年工作中比較具有代表性的東西, 想了一下, 應該就是social feed這東西了(寫這篇時, 想了一下該用啥名詞, 以往我會叫Timeline, 不過Social feed應該更為貼切一點),
趁現在才剛離職有些時間, 把這些東西整理一下, 主要還是以以前做過的東西的概念為主, 希望沒忘掉太多</p>

<p>這系列打算由三篇來構成, 除了這篇概念篇外, 另外還會有兩篇比較細節一點的內容, 分為client和server的部分(之後寫完會再更新鏈結):</p>

<ol>
  <li><a href="/淺談social-feed-多服務彙整式的social-feed-client">淺談Social Feed - 多服務彙整式的social feed (Client)</a></li>
  <li><a href="/淺談social-feed-後端架構實作-server/">淺談Social Feed - 後端架構實作 (Server)</a></li>
</ol>

<h2 id="social-feed">什麼是Social feed?</h2>

<p>如果要簡單的來解釋, 應該可以說是一條依時間線排序的社群動態, 來看看下面這張Twitter的畫面:</p>

<p><img src="/images/posts/p1021_twitter1.png" alt="" /></p>

<p>這算是一個簡單的例子, 基本上就是把社群動態一條線的排下來(所以之前我也比較習慣的把它叫做Timeline, 不過這邊會改叫Social feed是因為考慮到也有不是依時間排序的),
我不太確定最早是誰採用這樣的設計, 找了一些早期社群網站(Frienster, Myspace), 最早都還沒有這樣的設計:</p>

<p>Friendster (2002 原來那時候有繁中版?!):</p>

<p><img src="http://cbsnews2.cbsistatic.com/hub/i/r/2011/07/06/4a83463d-a643-11e2-a3f0-029118418759/resize/620x465/d16e61e54ecd40c300fa4a6d0e52bd37/friendster-AP070927023229.jpg" alt="" /></p>

<p>Myspace (2003):</p>

<p><img src="http://linapps.s3.amazonaws.com/linapps/photomojo/kxan.com/photos/2014/12/g15554-popular-releases-since-perry-took-office/287973-myspace-was-launched-in-july-2003-45b2f.jpg" alt="" /></p>

<p>即使是Facebook也要到2008年才有這樣的雛形(看下面這段video還蠻有趣的, 我好像也是那段時間開始跟這東西結下了孽緣)</p>

<div class="video"><figure><iframe width="640" height="480" src="//www.youtube.com/embed/Nl7igMfeOvo" frameborder="0" allowfullscreen=""></iframe></figure></div>

<p>再看看2006年的Twitter, 似乎就比較像是一個雛形的樣了, 不過那時似乎還像是一個粗劣的網站</p>

<p><img src="http://robbiesblog.com/wp-content/uploads/2015/08/Twitter-2006-1024x350.png" alt="" /></p>

<p>當然也不是所有的Social feed都是由上而下的, 另一個有名的變形就是創了河道的Plurk, Plurk在2008創立, 在台灣紅了一陣子, 但在智慧型手機的浪潮沒跟的很好, 到了手機上就很難發揮河道這樣的特色了</p>

<p><img src="/images/posts/post1021_plurk1.png" alt="" /></p>

<h2 id="section">現今的設計</h2>

<p>現在這時代, 智慧型手機當道, mobile first曾經流行過一陣子, 大家放很多心力在手機上, 但Social feed這東西, 到了手機上, 各家變化就不太大了, 大致上都很類似, 來看幾個手機上的範例:</p>

<h4 id="facebook">Facebook:</h4>

<p><img src="/images/posts/post1021_facebook1.png" alt="" /></p>

<h4 id="twitter">Twitter:</h4>

<p><img src="/images/posts/post1021_twitter2.png" alt="" /></p>

<h4 id="google">Google+:</h4>

<p><img src="/images/posts/post1021_googlep1.png" alt="" /></p>

<h4 id="linkedin">Linkedin:</h4>

<p><img src="/images/posts/post1021_linkedin.png" alt="" /></p>

<h4 id="instagram">Instagram</h4>

<p><img src="/images/posts/post1021_instagram1.png" alt="" /></p>

<h4 id="section-1">新浪微博</h4>

<p><img src="/images/posts/post1021_weibao.png" alt="" /></p>

<h4 id="pinterest">Pinterest</h4>

<p><img src="/images/posts/post1021_pinterest.png" alt="" /></p>

<p>這邊可以見到的是Pinterest採取了一個跟其他人不同的呈現方式, 但, 大體上的構成還是跟大家都相似的</p>

<p>另外可以發覺的是, 從2006在PC Web到現在2016手機上, 內容變複雜了, 從純粹文字到多媒體內容, 我個人其實不是那麼愛這種轉變, 因為要接收的資訊變多了, 雖然畫面變豐富更多,
但另外帶來的一個缺點, 尤其是在手機上, 螢幕已經不夠付載一則動態的資訊量了</p>

<h2 id="section-2">使用者介面構成與行為</h2>

<p>先以Facebook的介面當做例子來解釋(其他各家都大同小異啦):</p>

<p><img src="/images/posts/post1021_facebook2.jpg" alt="" /></p>

<p>大致上可以分做為三部分 - 作者資訊(藍色, 黃色區域), 內文資訊(綠色, 紅色, 咖啡色區域), 社群互動功能(紫色區域)</p>

<h3 id="section-3">作者資訊 (藍色, 黃色區)</h3>

<p>光字面上意思就已經表達完這部分了, 大致上都是放作者的圖像跟ID(或名字), 在Twitter因為還有轉推的動作, 所以還包含了轉貼人的資訊, 近年比較流行的設計是會用圓形的頭像(像上面例子的Instgram, 微博, Google+),
圓形的頭像大半在client app要顯示時處理掉就好, 只是一個圓形的mask, 就如同我以前寫過這篇:</p>

<p><a href="/android-圓形大頭貼-使用picasso的transformation/">圓形大頭貼 - 使用Picasso的Transformation</a></p>

<h3 id="section-4">發布時間 (綠色區域)</h3>

<p>一般說來, 發布時間這部分, 不會直接用絕對時間(幾年幾月幾日幾時幾分), 而是用”3分鐘前”, “4天前”這樣的絕對時間, 這樣的顯示方式似乎就已經是一個約定俗成的默契了</p>

<p>這種時間格式有個好處, 不用管時差問題, social feed的內容可能來自於世界各地不同的朋友, 每個人時區不同, 與其轉成當地時區的時間格式, 還不如以這種方式表示來得直接一點, 也不用管字串會不會有太長的問題</p>

<p>做這樣一個東西, 也是不用重新造輪子啦, 已經有了<a href="http://momentjs.com">moment.js</a>這樣方便的東西可以用了, 當然他也是有被移植到Javascript以外的, 比如說<a href="https://github.com/akosma/SwiftMoment">SwiftMoment</a></p>

<h3 id="section-5">內文以及相關資訊(紅, 橘, 咖啡區域)</h3>

<p>早期的social feed, 內容大多只有文字, 就算有連結的轉貼, 也只是多一個hyper link, 整體上讀起來還是文字, 接下來圖片被帶入後, 就變成有圖文夾雜格式出現,
Facebook這種通用的social network服務, 內容種類較多, 因此就會夾雜不同格式的內容, 除了純文字內容外, 還有圖片, 影像, 甚至, 現在多了個直播, 而像是Instagram這類以影像為主的,
格式就較為統一, 不過, 基本上也只是不同內容的內文顯示格式略有不同外, 在後面的資料結構理應大同小異</p>

<p>後來可能人們(不見得是使用者吧)不再滿足於單調的內容, 尤其是在社群網路上分享文章鏈結(像是分享新聞的)越來越多, 一堆超連結看起來也醜,
後來就出現了Twitter Card 和 Open graph這類的東西:</p>

<ol>
  <li><a href="https://developers.facebook.com/docs/sharing/webmasters">Open graph</a></li>
  <li><a href="https://dev.twitter.com/cards/overview">Twitter Card</a></li>
</ol>

<p>這進一步讓你可以去定義你自己的網站, 而社群服務像是Facebook再把你的網站當作一個物件, 以物件的類別來決定怎麼去呈現這個鏈結, 在視覺上就再更加的豐富</p>

<p>不過不管內容有多少種, 差別真的就是呈現方式的多寡, 呈現方式也是有限的, 在Client顯示設計上是可以設計靈活點可以擴展, 不過倒也不用考慮到會有無窮無盡的形式</p>

<p>另外跟內文相關的資訊常見的還會有喜歡這個動態的數目(Facebook還有多種情緒表示), 回文數目, 分享數目(不見得每個服務都有), 使用者可以透過這些數字來了解到這篇貼文的熱門程度,
但這些數字, 其實在大部分的服務裡都只能單參考用, 數字未必準確, 這是因為一來很難及時地把某則貼文按讚的狀態更新給所有人(對Server的負擔大, Client實作也複雜),
或許在視覺上可以用一些比較相對的表示方式而非絕對數量的表示</p>

<p>另外有些服務會節錄幾則(通常最多三則)回文跟著文章下面一起顯示, 像Facebook網頁版, 但一樣, 它也是難於即時的更新</p>

<h3 id="section-6">社群互動功能 (紫色區域)</h3>

<p>一般常見就是“喜歡(like)”, “回文(comment)”, “分享(share)”, 社群網路的精神主要還是在互動跟分享, 因此這幾個也差不多是最精簡也必備的了</p>

<h3 id="section-7">更進階一點的內容</h3>

<p>通常還會有所謂的 hashtag和mention (這邊以Twitter用詞)</p>

<p>所謂的hashtag是由User自訂, 跟這則內文相關的關鍵詞, 以”#”開頭, 差不多也是個約定俗成, 最早應該早在IRC時代就有在使用了,
什麼?沒聽過IRC?沒關係, 知道從很古早時代就有了, 設計上通常會把 #hashtag 作成連結的形式, 點下去顯示相關的文章</p>

<p>而mention指的是”提到”某某人, 所以通常的形式都是”@”後面加User ID, 這也已經是一種約定俗成的方式了, 設計上也都會是一個點下去就到那個人的資訊頁面的連結</p>

<h3 id="section-8">時間線回朔</h3>

<p>這部分我們以前都把它稱作”load more”, 不過覺得這樣講好像很難知其所以然, 先看一下圖:</p>

<p><img src="/images/posts/loadmore1.png" alt="" /></p>

<p>一般來說, 從Server端抓回來的文章不會一次傳回所有的, 因為那會實在太多了, 尤其對重度使用者來說, 從開始使用以來到現在可能為數不少, 因此當我們把整social feed (或time line或說stream)往下一直拉時,
總是會見底的</p>

<p>在以往的UI設計上大多會放一條”touch to load more”之類的讓使用者再讀取舊一點的資料(所以以往我們都會把它叫做load more),
但這樣的缺點是使用者體驗不會太好, 通常看到這條後就跳掉不看了, 因此後來就流行做成上圖那樣, 快拉到最下面時就預先抓取, 來不及抓完, 使用者就會看到轉圈圈的進度</p>

<p>最好的體驗應該是讓使用者無縫接軌, 可以一直一直往下拉不用中斷, 但這邊就存在有調整的空間了, 太晚觸發的話, 使用者滑到最下面還是會有等待時間, 等待時間只要一長了, 常常就沒耐性跑了,
所以如果可以提早一點抓取, 是可以減少拉到最下面的等待時間, 但到底要提早多少? 太早也不是一件好事, 可能會導致client太過頻繁跟server索取資料, 但實際上又用不到那麼多,
以至於浪費了太多的網路傳輸量, 以及增加了server的負擔, 但使用者滑動的速率每個都不同, 所以這是一件不好拿捏的事, 可能要經過多次試驗才會有比較好的體驗</p>

<h3 id="section-9">資料更新</h3>

<p>這比較會出現在有背景更新的場合, 如果每次使用者要看最新內容要自己觸發更新, 更新結束前他不能做任何動作, 那就沒這問題, 這問題主要出現在使用者在瀏覽過程中, 背景更新有了新資料進來,
輕微的話, 資料從最上頭插入導致他正在看的位置跑掉了, 嚴重的話, 可能整個刷新後, 內容都不同了, 這當然對使用者體驗很不好, 現在大部分的設計都會設計成非同步更新, 也就是就算是由使用者觸發,
更新時, 使用者還是有機會做動作, 更新時間如果太長了, 就容易發生這狀況</p>

<p>這部分的解法通常像下圖Twitter的做法:</p>

<p><img src="/images/posts/IMG_9618.png" alt="" /></p>

<p>不直接刷新頁面, 而是先提示使用者有新的貼文, 這樣的感覺就好多了</p>

<h2 id="social-feed-1">聚合式的social feed</h2>

<p>所謂的聚合式的, 就是把一堆Social service的feeds全部串在一起, 因為多數的使用者擁有不止一個社群網路帳號, 把所有放在一起在瀏覽上就不用一個個網站跑或一個app跳過一個app</p>

<p>最早著名的有Friendfeed, 它早已經被Facebook買下不存在了, 不過它就是這樣一個概念:</p>

<p><img src="http://d2chgkz0kdtxdm.cloudfront.net/wp-content/uploads/2009/04/friendfeed-after.png" alt="" /></p>

<p>另外手機上還有HTC的<a href="http://mobile.htc.com/learnmore/desires/eng/howtos/GUID-89A364D2-2043-46BD-9249-AA7BE00577A9.html">Friend stream</a>,
不過這個血和汗做來的產品也不在了 orz</p>

<p><img src="http://mobile.htc.com/learnmore/chacha/cht/howtos/GUID-9619718F-A721-4BAF-A4B4-C202E2A0D2B1-web.png" alt="" />
(好, 我拿chacha的畫面的確是故意的 :P)</p>

<p>另外還有一個叫做<a href="https://hootsuite.com">HootSuite</a>的也是類似:</p>

<p><img src="/images/posts/post1021_hootsuite.png" alt="" /></p>

<p>不過HootSuite跟前兩者有所不同的地方是它並未把Social feed全部整合在一個時間線, 而只是並列顯示, 全部整合的難度稍高, 這就留待下一篇來說明了</p>

<h2 id="section-10">小結</h2>

<p>整理了這麼多, 是後面兩篇的前置, 這邊的概念等於是設計一個social feeds的”需求”, 後面兩篇會再用到這些概念</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-10-18T21:01:31+08:00"><a href="http://blog.jln.co/account-kit-samples-for-swift/">October 18, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://blog.jln.co/about/" title="About Julian Shen">Julian Shen</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://blog.jln.co/account-kit-samples-for-swift/" rel="bookmark" title="Account Kit samples for Swift" itemprop="url">Account Kit samples for Swift</a></h1>
    
  </header>
  <div class="entry-content">
    <p>做一個網路服務, 使用者驗證是蠻麻煩的一件事, 我們是可以裝作沒看到, 不做驗證, 但這樣的下場就是有假使用者, 有殭屍, 最簡單的方式是信任第三方服務像是Google, Facebook,
現在的人大多數都有Google, Facebook帳號了, 這樣其實也沒多大的問題, 但還是還是有人沒有, 而且也不是每個人都放心把Facebook帳號交給我們, 因此退而求其次就是用E-mail,
用E-mail認證雖然也是一個好方式, 但還是要建置整套發信機制(或是花錢買mailgun來送信), 而且在手機上就麻煩了, 來回在App跟e-mail間切換很不方便,
因此就會想用簡訊認證, 至於簡訊認證, 除了一個”貴”字以外, 要搞定各個國家的也是一個麻煩(當然, 花錢可解, 有Twilio這種服務可以用)</p>

<p>所幸有Facebook提供的這個可以用<a href="https://developers.facebook.com/docs/accountkit">Account Kit</a>, 在初期使用者不太多的時候, 不收費的確很吸引人呀(雖然他不是唯一一個這樣的服務, 之後再介紹其他的),
但由於他<a href="https://github.com/fbsamples/account-kit-samples-for-ios">iOS的範例</a>是用Objective C寫的, 我的Objective C實在不太行,
加上, 要了解一個東西, 寫一遍就知道了, 所以順手翻譯了一個Swift的版本, Source如下:</p>

<h2 id="account-kit-samples-for-swifthttpsgithubcomjulianshenaccount-kit-samples-for-swift"><a href="https://github.com/julianshen/account-kit-samples-for-swift">Account Kit samples for Swift</a></h2>

<p>原本的版本, 我是覺得寫的不是太好, 花了好一些功夫看, 自己翻過來的這個版本, 也還沒debug過, 基礎的應該堪用啦! 至於iOS的account kit文件可以參考: <a href="https://developers.facebook.com/docs/accountkit/ios">iOS 專用 Account Kit</a></p>

<p>註: plist裡面寫的app id不是我的喔!是原本Sample用的</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-10-17T20:38:54+08:00"><a href="http://blog.jln.co/%E5%9C%A8ubuntu%E4%B8%8Bmount-box.com%E7%9A%84%E5%85%A7%E5%AE%B9/">October 17, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://blog.jln.co/about/" title="About Julian Shen">Julian Shen</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://blog.jln.co/%E5%9C%A8ubuntu%E4%B8%8Bmount-box.com%E7%9A%84%E5%85%A7%E5%AE%B9/" rel="bookmark" title="在Ubuntu下mount box.com的內容" itemprop="url">在Ubuntu下mount box.com的內容</a></h1>
    
  </header>
  <div class="entry-content">
    <p>雖然很久沒用box.com的服務了, 不過既然老婆大人問起, 就來寫一下這解法吧</p>

<p>box.com是一個像Dropbox一樣的網路磁碟, 不過它目標客戶跟Dropbox不同, 是比較傾向企業用戶, 可以讓用戶很簡單的分享檔案,
存取box.com除了一般使用Web介面的方式外, 還有其他的方式, 像是透過它的REST API, 另外還有一種就是透過WebDav, 
如果要寫程式去存取它, 一般可以用這兩種方式, 用REST稍微複雜一點, 還要搞定OAuth2的部分, 但透過WebDav的話就簡單多了, 可以掛載成為你作業系統底下的目錄, 當本地檔案來處理</p>

<h4 id="davfs2">安裝davfs2</h4>

<p>首先, 你會需要的是davfs2, 在Ubuntu下用apt-get安裝:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>sudo apt-get install davfs2
</code></pre>
</div>

<h4 id="section">設定帳號密碼</h4>

<p>修改<code class="highlighter-rouge">/etc/davfs2/secrets</code>, 加入</p>

<div class="highlighter-rouge"><pre class="highlight"><code>https://dav.box.com/dav box.com帳號 密碼
</code></pre>
</div>

<h4 id="section-1">掛載</h4>

<p>執行底下指令掛載</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo mkdir /mnt/box.com
sudo -t davfs https://dav.box.com/dav /mnt/box.com
</code></pre>
</div>

<p>成功之後,就會在/mnt/box.com底下看到你的檔案了(包含人家分享給你協作的檔案根目錄), 之後當本地端檔案存取即可, 設定好auto mount即可在開機後掛載</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-10-06T23:10:04+08:00"><a href="http://blog.jln.co/%E7%AD%86%E8%A8%98-ios%E9%96%8B%E7%99%BC-%E4%BD%BF%E7%94%A8mapkit%E5%81%9A%E4%B8%80%E5%80%8B%E7%B0%A1%E5%96%AE%E7%9A%84%E9%A3%9B%E8%A1%8C%E5%8B%95%E7%95%AB/">October 06, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://blog.jln.co/about/" title="About Julian Shen">Julian Shen</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://blog.jln.co/%E7%AD%86%E8%A8%98-ios%E9%96%8B%E7%99%BC-%E4%BD%BF%E7%94%A8mapkit%E5%81%9A%E4%B8%80%E5%80%8B%E7%B0%A1%E5%96%AE%E7%9A%84%E9%A3%9B%E8%A1%8C%E5%8B%95%E7%95%AB/" rel="bookmark" title="[筆記][ios開發] 使用MapKit做一個簡單的飛行動畫" itemprop="url">[筆記][ios開發] 使用MapKit做一個簡單的飛行動畫</a></h1>
    
  </header>
  <div class="entry-content">
    <p>小時候很喜歡Indiana Jones系列的電影, 對於它裡面的地圖片段也一直覺得很有趣</p>

<div class="video"><figure><iframe width="640" height="480" src="//www.youtube.com/embed/FhoPTyMUgX0" frameborder="0" allowfullscreen=""></iframe></figure></div>

<p>如果這樣的動畫, 用在遊記類的blog上, 應該也蠻酷的, 但好像也沒一個比較好的工具, 因此想說用MapKit來實作一個試試</p>

<h3 id="section">功能需求</h3>

<p>先來定義一個簡單的功能需求</p>

<ol>
  <li>在起點跟終點畫一條連結線</li>
  <li>一架飛機延這條線飛到終點</li>
  <li>地圖視角跟著飛機走</li>
</ol>

<h3 id="section-1">實作</h3>

<h4 id="section-2">在起點跟終點畫一條連結線</h4>

<p>這部份要用到MKGeodesicPolyline, 給它兩個點, 它就會自動連結成一條線, 但這條線並不是完美的直線, 因為地球表面是曲面的, 所以它是一條弧線</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span>

<span class="n">geodesicPolyline</span> <span class="o">=</span> <span class="kt">MKGeodesicPolyline</span><span class="p">(</span><span class="nv">coordinates</span><span class="p">:</span> <span class="n">coords</span><span class="p">,</span> <span class="nv">count</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">geodesicPolyline</span><span class="o">!.</span><span class="n">pointCount</span><span class="p">)</span>
<span class="n">mapView</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">geodesicPolyline</span><span class="o">!</span><span class="p">)</span>
</code></pre>
</div>

<p>這邊coors只要給訂起始點跟終點的位置就好, 印出pointCount就會發現它把經由的點都補足了(實際上印出來的會多出2很多很多)</p>

<p>MKGeodesicPolyline裡的參數coordinates是一個UnsafeMutablePointer, 在Swift 3之前要寫成&amp;coords, 但在Swift 3大改之後, “&amp;”就不需要了</p>

<p>由於MKGeodesicPolyline是一個Overlay, 因此最後只需要用mapView.add (Swift 3之前是addOverlay)加入mapView就可以了, 但加入之後, 會發現, 這條線根本沒被畫出來, 那是因為少寫了一部分</p>

<p>在MapView裡面要畫出Overlay, 就必須要跟MapView說怎麼畫出這個Overlay, 這就要實作MKMapViewDelegate裡的mapView(_ mapView: MKMapView, rendererFor overlay: MKOverlay)</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">mapView</span><span class="p">(</span><span class="n">_</span> <span class="nv">mapView</span><span class="p">:</span> <span class="kt">MKMapView</span><span class="p">,</span> <span class="n">rendererFor</span> <span class="nv">overlay</span><span class="p">:</span> <span class="kt">MKOverlay</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">MKOverlayRenderer</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">polyline</span> <span class="o">=</span> <span class="n">overlay</span> <span class="k">as?</span> <span class="kt">MKPolyline</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">MKOverlayRenderer</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="k">let</span> <span class="nv">renderer</span> <span class="o">=</span> <span class="kt">MKPolylineRenderer</span><span class="p">(</span><span class="nv">polyline</span><span class="p">:</span> <span class="n">polyline</span><span class="p">)</span>
    <span class="n">renderer</span><span class="o">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="n">renderer</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">renderer</span><span class="o">.</span><span class="n">strokeColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">blue</span>
    
    <span class="k">return</span> <span class="n">renderer</span>
<span class="p">}</span>
</code></pre>
</div>

<p>由於我們是要畫Poly line, 因此這邊回傳給它一個MKPolylineRenderer, 線寬是3.0, 線的顏色是藍色(alpha = 0.5)</p>

<p>這樣就可以很完美的畫出那條線了</p>

<h4 id="section-3">在地圖上畫出飛機</h4>

<p>這部份就要借重到MKPointAnnotation</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">thePlane</span> <span class="o">=</span> <span class="kt">MKPointAnnotation</span><span class="p">()</span>
<span class="n">thePlane</span><span class="o">.</span><span class="n">coordinate</span> <span class="o">=</span> <span class="n">start</span> <span class="c1">//給定起始座標</span>
        
<span class="n">mapView</span><span class="o">.</span><span class="nf">addAnnotation</span><span class="p">(</span><span class="n">thePlane</span><span class="p">)</span>
</code></pre>
</div>

<p>一樣, 這邊如果沒告訴MapView怎畫這Annotation, 它是會用預設的取代, 因此我們一樣要去實作MKMapViewDelegate</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">mapView</span><span class="p">(</span><span class="n">_</span> <span class="nv">mapView</span><span class="p">:</span> <span class="kt">MKMapView</span><span class="p">,</span> <span class="n">viewFor</span> <span class="nv">annotation</span><span class="p">:</span> <span class="kt">MKAnnotation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">MKAnnotationView</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">planeIdentifier</span> <span class="o">=</span> <span class="s">"Plane"</span>
    
    <span class="k">let</span> <span class="nv">annotationView</span> <span class="o">=</span> <span class="n">mapView</span><span class="o">.</span><span class="nf">dequeueReusableAnnotationView</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="n">planeIdentifier</span><span class="p">)</span>
        <span class="p">??</span> <span class="kt">MKAnnotationView</span><span class="p">(</span><span class="nv">annotation</span><span class="p">:</span> <span class="n">annotation</span><span class="p">,</span> <span class="nv">reuseIdentifier</span><span class="p">:</span> <span class="n">planeIdentifier</span><span class="p">)</span>
    
    <span class="n">annotationView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"ic_flight_48pt"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">annotationView</span>
<span class="p">}</span>
</code></pre>
</div>

<p>這邊用一個UIImage來指定飛機的圖標</p>

<h4 id="section-4">地圖視角</h4>

<p>把飛機置於地圖正中央, 我們才看得到他, 因此, 需要設定可視的區域, 包含中心點跟範圍, 如下:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">span</span> <span class="o">=</span> <span class="kt">MKCoordinateSpanMake</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">region1</span> <span class="o">=</span> <span class="kt">MKCoordinateRegion</span><span class="p">(</span><span class="nv">center</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="nv">span</span><span class="p">:</span> <span class="n">span</span><span class="p">)</span>
<span class="k">self</span><span class="o">.</span><span class="n">mapView</span><span class="o">.</span><span class="nf">setRegion</span><span class="p">(</span><span class="n">region1</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="section-5">沿著線飛</h4>

<p>這時候要利用到 perform(#selector(updatePlane), with: self, afterDelay: 0.4) 讓它每隔0.4秒去更新一次飛機位置, 直到到終點為止, 當然也要一直更新region, 以讓飛機維持在正中央</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">updatePlane</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">planePositionIndex</span> <span class="o">=</span> <span class="n">planePositionIndex</span> <span class="o">+</span> <span class="n">step</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">planePositionIndex</span> <span class="o">&gt;=</span> <span class="n">geodesicPolyline</span><span class="o">!.</span><span class="n">pointCount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//plane has reached end, stop moving</span>
        <span class="n">planePositionIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">let</span> <span class="nv">s</span> <span class="o">=</span> <span class="mf">8.0</span>
    
    <span class="k">let</span> <span class="nv">nextMapPoint</span> <span class="o">=</span> <span class="n">geodesicPolyline</span><span class="p">?</span><span class="o">.</span><span class="nf">points</span><span class="p">()[</span><span class="n">planePositionIndex</span><span class="p">]</span>

    <span class="n">thePlane</span><span class="o">.</span><span class="n">coordinate</span> <span class="o">=</span> <span class="kt">MKCoordinateForMapPoint</span><span class="p">(</span><span class="n">nextMapPoint</span><span class="o">!</span><span class="p">)</span> 
    <span class="n">mapView</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="kt">MKCoordinateRegionMake</span><span class="p">(</span><span class="n">thePlane</span><span class="o">.</span><span class="n">coordinate</span><span class="p">,</span> <span class="kt">MKCoordinateSpan</span><span class="p">(</span><span class="nv">latitudeDelta</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="nv">longitudeDelta</span><span class="p">:</span> <span class="n">s</span><span class="p">))</span>

    <span class="nf">perform</span><span class="p">(</span><span class="kd">#selector(</span><span class="nf">updatePlane</span><span class="kd">)</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">afterDelay</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="section-6">結果</h3>

<div class="video"><figure><iframe width="640" height="480" src="//www.youtube.com/embed/GSAd1Vygkhw" frameborder="0" allowfullscreen=""></iframe></figure></div>

<p>這邊有幾個缺點尚待改進</p>

<ol>
  <li>飛機閃爍</li>
  <li>如果把可視區域範圍縮小, 或是位置更新過快, 就會造成地圖來不及載入的現象(可能需要預跑幾次將map tile載入cache內)</li>
  <li>飛機頭永遠保持往上, 應該要朝著線方向轉</li>
</ol>

<h3 id="section-7">完整程式碼</h3>

<noscript><pre>//
//  ViewController.swift
//  mapanitest
//
//  Created by Julian Shen on 2016/10/4.
//  Copyright © 2016年 cowbay.wtf. All rights reserved.
//

import UIKit
import MapKit
import LocationPickerViewController

class ViewController: UIViewController, MKMapViewDelegate {
    @IBOutlet weak var mapView: MKMapView!
    
    
    var planePositionIndex:Int = 0
    var geodesicPolyline:MKGeodesicPolyline?
    let thePlane = MKPointAnnotation()
    var startloc, endloc: CLLocationCoordinate2D?
    var step:Int = 50
    
    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view, typically from a nib.
        print(&quot;view did load&quot;)
        
        mapView.delegate = self
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }

    func updatePlane() {
        planePositionIndex = planePositionIndex + step;
        
        if (planePositionIndex &gt;= geodesicPolyline!.pointCount)
        {
            //plane has reached end, stop moving
            planePositionIndex = 0
            return;
        }
        
        let s = 8.0
        
        let nextMapPoint = geodesicPolyline?.points()[planePositionIndex]
        
        thePlane.coordinate = MKCoordinateForMapPoint(nextMapPoint!)
        
        mapView.region = MKCoordinateRegionMake(thePlane.coordinate, MKCoordinateSpan(latitudeDelta: s, longitudeDelta: s))

        perform(#selector(updatePlane), with: self, afterDelay: 0.4)
    }
    
    func mapView(_ mapView: MKMapView, rendererFor overlay: MKOverlay) -&gt; MKOverlayRenderer {
        guard let polyline = overlay as? MKPolyline else {
            return MKOverlayRenderer()
        }
        
        let renderer = MKPolylineRenderer(polyline: polyline)
        renderer.lineWidth = 3.0
        renderer.alpha = 0.5
        renderer.strokeColor = UIColor.blue
        
        return renderer
    }
    
    func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {
        let planeIdentifier = &quot;Plane&quot;
        
        let annotationView = mapView.dequeueReusableAnnotationView(withIdentifier: planeIdentifier)
            ?? MKAnnotationView(annotation: annotation, reuseIdentifier: planeIdentifier)
        
        annotationView.image = UIImage(named: &quot;ic_flight_48pt&quot;)
        
        return annotationView
    }
    
    @IBAction func pickLocation(_ sender: AnyObject) {
        let button = sender as! UIButton
        
        
        let locationPicker = LocationPicker()
        locationPicker.pickCompletion = { (pickedLocationItem) in
            // Do something with the location the user picked.
            print(pickedLocationItem.coordinate)
            print(button.accessibilityIdentifier)
            
            let coord = pickedLocationItem.coordinate!
            
            if button.accessibilityIdentifier == &quot;startloc&quot; {
                self.startloc = CLLocationCoordinate2D(latitude: coord.latitude, longitude: coord.longitude)
            } else if button.accessibilityIdentifier == &quot;endloc&quot; {
                self.endloc = CLLocationCoordinate2D(latitude: coord.latitude, longitude: coord.longitude)
            }
        }
        locationPicker.addBarButtons()
        
        let navigationController = UINavigationController(rootViewController: locationPicker)
            present(navigationController, animated: true) {
        }

        
    }
    
    @IBAction func displayPath(_ sender: AnyObject) {
        guard let sl = startloc else {
            print(&quot;error: no startloc&quot;)
            return
        }
        
        guard let el = endloc else {
            print(&quot;error: no endloc&quot;)
            return
        }
        
        let coordinates = [sl, el]
        
        if let gl = geodesicPolyline {
            mapView.remove(gl)
        }
        
        geodesicPolyline = MKGeodesicPolyline(coordinates: coordinates, count: 2)
        
        print(geodesicPolyline!.pointCount)
        step = geodesicPolyline!.pointCount/(Int)(20/0.4)
        mapView.add(geodesicPolyline!)
        
        thePlane.coordinate = sl
        
        mapView.addAnnotation(thePlane)
        
        UIView.animate(withDuration: 1.5) {
            let span = MKCoordinateSpanMake(8.0, 8.0)
            let region1 = MKCoordinateRegion(center: sl, span: span)
            self.mapView.setRegion(region1, animated: true)
            
            self.perform(#selector(self.updatePlane), with: self, afterDelay: 0.4)
        }
    }
}

</pre></noscript>
<script src="https://gist.github.com/julianshen/229f4ac32b3893816bd7636b96fe6f7d.js"> </script>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    
      
        <li><a href="http://blog.jln.co/page5/" class="btn">Previous</a></li>
      
    

    
    
      <li><a href="http://blog.jln.co">1</a></li>
    

    
    
      
      
      <li>…</li>
    

    
    
    

    
      
        
        
        
        <li><a href="http://blog.jln.co/page4/">4</a></li>
      
    
      
        
        
        
        <li><a href="http://blog.jln.co/page5/">5</a></li>
      
    
      
        <li><strong class="current-page">6</strong></li>
      
    
      
        
        
        
        <li><a href="http://blog.jln.co/page7/">7</a></li>
      
    
      
        
        
        
        <li><a href="http://blog.jln.co/page8/">8</a></li>
      
    

    
    
      <li>…</li>
    

    
      <li><a href="http://blog.jln.co/page71/">71</a></li>
    

    
    
      <li><a href="http://blog.jln.co/page7/" class="btn">Next</a></li>
    
  </ul>
</div>


</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Julian Shen. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://blog.jln.co/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://blog.jln.co/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79243751-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


          

</body>
</html>