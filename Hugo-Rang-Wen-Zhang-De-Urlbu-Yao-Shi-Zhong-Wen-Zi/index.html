<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=en><![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang=en><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang=en><![endif]--><!--[if gt IE 8]><!--><html class=no-js lang=en><!--<![endif]--><head><meta charset=utf-8><title>[Hugo] 讓文章的URL不要是中文字 &#8211; Le murmure de Julian</title><meta name=description content><meta property="og:url" content="https://blog.jln.co/Hugo-Rang-Wen-Zhang-De-Urlbu-Yao-Shi-Zhong-Wen-Zi/"><meta property="og:site_name" content="Le murmure de Julian"><meta property="og:title" content="[Hugo] 讓文章的URL不要是中文字"><meta property="og:description" content="在發表前一篇時, Evan 跟我說, “能不能用slug把url改好看點?”, 從開始寫blog來, 其實我也沒在意有沒人看, 所以SEO相關的也沒太在意, 但既然有人講了, 我就來弄一下吧"><meta property="og:locale" content="zh_tw"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-11-10T13:57:03+08:00"><meta property="article:modified_time" content="2022-11-10T13:57:03+08:00"><meta property="og:image" content="https://og.jln.co/jlns1/W0h1Z29dIOiuk-aWh-eroOeahFVSTOS4jeimgeaYr-S4reaWh-Wtlw"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://og.jln.co/jlns1/W0h1Z29dIOiuk-aWh-eroOeahFVSTOS4jeimgeaYr-S4reaWh-Wtlw"><meta name=twitter:title content="[Hugo] 讓文章的URL不要是中文字"><meta name=twitter:description content="在發表前一篇時, Evan 跟我說, “能不能用slug把url改好看點?”, 從開始寫blog來, 其實我也沒在意有沒人看, 所以SEO相關的也沒太在意, 但既然有人講了, 我就來弄一下吧"><link rel=canonical href=https://blog.jln.co/Hugo-Rang-Wen-Zhang-De-Urlbu-Yao-Shi-Zhong-Wen-Zi/><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/main.css><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel=stylesheet type=text/css><meta http-equiv=cleartype content="on"><meta name=generator content="Hugo 0.149.1"><script src=/js/vendor/modernizr-2.6.2.custom.min.js></script><script async src=https://unpkg.com/mermaid@8.2.3/dist/mermaid.min.js></script><link rel="shortcut icon" href=/favicon.png></head><body id=post><nav id=dl-menu class=dl-menuwrapper role=navigation style=display:inline-block><button class=dl-trigger>Open Menu</button><ul class=dl-menu><li><a href=/>Home</a></li><li><a href=#>About</a><ul class=dl-submenu><li><img src=/images/avatar.png alt="Julian Shen's photo" class=author-photo><h4>Julian Shen</h4><p>Softward developer</p></li><li><a href=mailto:julianshen22@gmail.com><i class="fa fa-fw fa-envelope"></i> Email</a></li><li><a href=https://linkedin.com/in/julianshen><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a></li><li><a href=https://github.com/julianshen><i class="fa fa-fw fa-github"></i> GitHub</a></li><li><a href=https://instagram.com/julianshen><i class="fa fa-fw fa-instagram"></i> Instagram</a></li></ul></li><li><a href=#>Posts</a><ul class=dl-submenu><li><a href=/post/>All Posts</a></li><li><a href=/tags/>All Tags</a></li></ul></li><li><a href=/></a></li></ul></nav><div id=main role=main><article class=hentry><header class=header-title><div class=header-title-wrap><h1 class=entry-title><a href=/Hugo-Rang-Wen-Zhang-De-Urlbu-Yao-Shi-Zhong-Wen-Zi/ rel=bookmark title="[Hugo] 讓文章的URL不要是中文字">[Hugo] 讓文章的URL不要是中文字</a></h1><h2><span class="entry-date date published"><time datetime="2022-11-10 13:57:03 +0800 +0800">November 10, 2022</time></span></h2><p class=entry-reading-time><i class="fa fa-clock-o"></i>
Reading time ~3 minutes</p></div></header><div class=entry-content><p>在發表<a href=dapr-raw-payload-pub-sub>前一篇</a>時, <a href=https://www.evanlin.com/>Evan</a> 跟我說, &ldquo;能不能用slug把url改好看點?&rdquo;, 從開始寫blog來, 其實我也沒在意有沒人看, 所以SEO相關的也沒太在意, 但既然有人講了, 我就來弄一下吧</p><h3 id=prama-links的設定>Prama links的設定</h3><p>首先先來看看pramalinks設定的部分:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>permalinks</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>post</span> = <span style=color:#e6db74>&#34;/:slug/&#34;</span>
</span></span></code></pre></div><p>這邊就是用來設定你URL長相的地方, 我的原文都放在post目錄內, 所以我一開始的設定就是以slug當URL沒錯, 那怎還是有中文呢?</p><h3 id=archetypes-初始文章的設定>Archetypes, 初始文章的設定</h3><p>當你用<code>hugo new filename</code>, 他會拿<code>themes/[theme_name]/archetypes/default.md</code>當範本來建立初始文章, 像我原本的設定是:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>date</span>: {{ <span style=color:#ae81ff>.Date }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>title</span>: <span style=color:#e6db74>&#34;{{ replace .Name &#34;</span>-<span style=color:#e6db74>&#34; &#34;</span> <span style=color:#e6db74>&#34; | title }}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>images</span>: 
</span></span><span style=display:flex><span>- <span style=color:#e6db74>&#34;https://og.jln.co/jlns1/{{ replace .Name &#34;</span>-<span style=color:#e6db74>&#34; &#34;</span> <span style=color:#e6db74>&#34; | title | base64Encode | replaceRE &#34;</span><span style=color:#ae81ff>=+$&#34; &#34;&#34; | replaceRE &#34;\\+&#34; &#34;-&#34; | replaceRE &#34;/&#34; &#34;_&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>draft</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>---
</span></span></code></pre></div><p>slug是沒設定的, 不過它似乎應該會用title去算slug, 所以在Paramlinks那邊沒啥影響, 但其實你也可以加一行變成:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>date</span>: {{ <span style=color:#ae81ff>.Date }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>title</span>: <span style=color:#e6db74>&#34;{{ replace .Name &#34;</span>-<span style=color:#e6db74>&#34; &#34;</span> <span style=color:#e6db74>&#34; | title }}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>slug</span>: <span style=color:#e6db74>&#34;{{ anchorize .Name | title }}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>images</span>: 
</span></span><span style=display:flex><span>- <span style=color:#e6db74>&#34;https://og.jln.co/jlns1/{{ replace .Name &#34;</span>-<span style=color:#e6db74>&#34; &#34;</span> <span style=color:#e6db74>&#34; | title | base64Encode | replaceRE &#34;</span><span style=color:#ae81ff>=+$&#34; &#34;&#34; | replaceRE &#34;\\+&#34; &#34;-&#34; | replaceRE &#34;/&#34; &#34;_&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>draft</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>---
</span></span></code></pre></div><p>anchorize是可以把"This is a cat"轉成"this-is-a-cat", 其實這兩段效果差不多, 問題在, 不支援中文, 因此像是"這是中文 Chinese", 其實翻成的是"這是中文-chinese", 如果再把這段放到url, unicode url並不是很好看</p><p>找了半天, 並不是很好用, 本來想寫個wrapper script來做新建文章好了, 然後自動加入比較好看的slug, 但轉念一想, 何不直接改Hugo?何不直接改Hugo?何不直接改Hugo? (回音持續)</p><h3 id=支援中文的slug轉換的go-module>支援中文的slug轉換的go module</h3><p>推薦這個<a href=https://github.com/gosimple/slug>github.com/gosimple/slug</a>, 這不只支援中文, 很多語言都有!用法也很簡單:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/gosimple/slug&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>someText</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>slug</span>.<span style=color:#a6e22e>Make</span>(<span style=color:#e6db74>&#34;影師&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>someText</span>) <span style=color:#75715e>// Will print: &#34;ying-shi&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>(以上範例來自它github)它很貼心的幫你把中文字轉成拼音了, 這用來做url感覺還蠻適合的呀!</p><h3 id=修改hugo>修改Hugo</h3><p>那我要加在Hugo哪裡呢?前面說到<code>anchorize</code>, 那其實仿效它做一個<code>slugify</code>不就好了, 那也容易知道要改哪, 抄<code>anchorize</code>就對了</p><p>要改的只有兩個檔:</p><ul><li>tpl/urls/init.go</li><li>tpl/urls/urls.go</li></ul><p>在<code>tpl/urls/urls.go</code>加入:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>ns</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Namespace</span>) <span style=color:#a6e22e>Slugify</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>any</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ss</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cast</span>.<span style=color:#a6e22e>ToStringE</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>slug</span>.<span style=color:#a6e22e>Make</span>(<span style=color:#a6e22e>ss</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然後在<code>tpl/urls/init.go</code>的<code>init()</code>內加入:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#a6e22e>ns</span>.<span style=color:#a6e22e>AddMethodMapping</span>(<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Slugify</span>,
</span></span><span style=display:flex><span>    []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;slugify&#34;</span>},
</span></span><span style=display:flex><span>    [][<span style=color:#ae81ff>2</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>`</span><span style=color:#75715e>{{</span> <span style=color:#e6db74>&#34;This is a title&#34;</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>slugify</span> <span style=color:#75715e>}}</span><span style=color:#e6db74>`</span>, <span style=color:#e6db74>`this-is-a-title`</span>},
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>重新建置安裝好後, 就可以把<code>Archetypes</code>改成:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>date</span>: {{ <span style=color:#ae81ff>.Date }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>title</span>: <span style=color:#e6db74>&#34;{{ replace .Name &#34;</span>-<span style=color:#e6db74>&#34; &#34;</span> <span style=color:#e6db74>&#34; | title }}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>slug</span>: <span style=color:#e6db74>&#34;{{ slugify .Name | title }}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>images</span>: 
</span></span><span style=display:flex><span>- <span style=color:#e6db74>&#34;https://og.jln.co/jlns1/{{ replace .Name &#34;</span>-<span style=color:#e6db74>&#34; &#34;</span> <span style=color:#e6db74>&#34; | title | base64Encode | replaceRE &#34;</span><span style=color:#ae81ff>=+$&#34; &#34;&#34; | replaceRE &#34;\\+&#34; &#34;-&#34; | replaceRE &#34;/&#34; &#34;_&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>draft</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>---
</span></span></code></pre></div><p>搞定! 結果寫這些code五分鐘, 但卻花了五十分鐘找方法呀, 果然Open source還是自己改來用最快</p><footer class=entry-meta><span class=entry-tags></span><div class=social-share><ul class="socialcount socialcount-small inline-list"><li class=facebook><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.jln.co%2fHugo-Rang-Wen-Zhang-De-Urlbu-Yao-Shi-Zhong-Wen-Zi%2f" target=_blank title="Share on Facebook"><span class=count><i class="fa fa-facebook-square"></i> Like</span></a></li><li class=twitter><a href="https://twitter.com/intent/tweet?text=https%3a%2f%2fblog.jln.co%2fHugo-Rang-Wen-Zhang-De-Urlbu-Yao-Shi-Zhong-Wen-Zi%2f" target=_blank title="Share on Twitter"><span class=count><i class="fa fa-twitter-square"></i> Tweet</span></a></li><li class=line><a href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fblog.jln.co%2fHugo-Rang-Wen-Zhang-De-Urlbu-Yao-Shi-Zhong-Wen-Zi%2f" target=_blank title="Share on LINE"><span class=count><i class="fab fa-line"></i>LINE</span></a></li></ul></div></footer></div><section id=disqus_thread><div class=fb-comments data-href=https://blog.jln.co/Hugo-Rang-Wen-Zhang-De-Urlbu-Yao-Shi-Zhong-Wen-Zi/ data-numposts=5 data-width></div></section></article></div><div class=footer-wrapper><footer role=contentinfo><span>Powered by <a href=https://gohugo.io/ rel=nofollow>Hugo</a> using the <a href=https://github.com/dldx/hpstr-hugo-theme rel=nofollow>HPSTR theme</a>.</span></footer></div><script src=//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js></script><script src=https://kit.fontawesome.com/872a53b461.js crossorigin=anonymous></script><script>window.jQuery||document.write('<script src="/js/vendor/jquery-1.9.1.min.js"><\/script>')</script><script src=/js/scripts.min.js></script><div id=fb-root></div><script async defer crossorigin=anonymous src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=293999444006555&autoLogAppEvents=1" nonce=geZSUIUh></script></body></html>